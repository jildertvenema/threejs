(this["webpackJsonpredcat-threejs"]=this["webpackJsonpredcat-threejs"]||[]).push([[0],{134:function(t,e,i){var n,a,o;window.self;a=[i(95)],void 0===(o="function"===typeof(n=function(t){return function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}e.prototype._read=function(){if(this.vfileheader=t.bytesToStr(this._io.readBytes(24),"ASCII"),this.filetype=this._io.readU4le(),this.fileversion=this._io.readU4le(),this.hasbody=this._io.readU4le(),this.motioncount=this._io.readU4le(),this.vsubfileheader=t.bytesToStr(this._io.readBytes(24),"ASCII"),this.subfiletype=this._io.readU4le(),this.subfileversion=this._io.readU4le(),this.body=new i(this._io,this,this._root),this.randomMeuk=t.bytesToStr(this._io.readBytes(138+38*this.body.numMaterialArray),"ASCII"),this.motioncount>0){this.motionSubfiles=[];for(var e=0;e<this.motioncount;e++)this.motionSubfiles.push(new o(this._io,this,this._root))}};var i=e.Body=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.boundingBoxMin=new v(this._io,this,this._root),this.boundingBoxMax=new v(this._io,this,this._root),this.numSkinVertexArray=this._io.readS2le(),this._raw_skinVertexArray=[],this.skinVertexArray=[];for(var e=0;e<this.numSkinVertexArray;e++){this._raw_skinVertexArray.push(this._io.readBytes(24));var i=new t(this._raw_skinVertexArray[e]);this.skinVertexArray.push(new s(i,this,this._root))}for(this.numSkinNormalArray=this._io.readS2le(),this._raw_skinNormalArray=[],this.skinNormalArray=[],e=0;e<this.numSkinNormalArray;e++){this._raw_skinNormalArray.push(this._io.readBytes(16));var n=new t(this._raw_skinNormalArray[e]);this.skinNormalArray.push(new r(n,this,this._root))}for(this.numBoneArray=this._io.readS2le(),this._raw_boneArray=[],this.boneArray=[],e=0;e<this.numBoneArray;e++){this._raw_boneArray.push(this._io.readBytes(76));var a=new t(this._raw_boneArray[e]);this.boneArray.push(new u(a,this,this._root))}for(this.boneNames=new w(this._io,this,this._root),this.numMaterialArray=this._io.readS2le(),this._raw_materialArray=[],this.materialArray=[],e=0;e<this.numMaterialArray;e++){this._raw_materialArray.push(this._io.readBytes(16));var o=new t(this._raw_materialArray[e]);this.materialArray.push(new b(o,this,this._root))}for(this.materialNames=new w(this._io,this,this._root),this.levelsOfDetail=this._io.readS4le(),this.skinFaces=new k(this._io,this,this._root),this.bitmaps=[],e=0;e<this.numMaterialArray;e++)this.bitmaps.push(new c(this._io,this,this._root))},e}(),n=e.Path=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.u=this._io.readU4le(),this.hasTranslationKeylist&&(this.translationKeylist=new f(this._io,this,this._root)),this.hasRotationKeylist&&(this.rotationKeylist=new _(this._io,this,this._root))},Object.defineProperty(t.prototype,"rotationInterpolationType",{get:function(){return void 0!==this._m_rotationInterpolationType||this.isBinaryType&&(this._m_rotationInterpolationType=this.u>>>2&127),this._m_rotationInterpolationType}}),Object.defineProperty(t.prototype,"hasRotationKeylist",{get:function(){return void 0!==this._m_hasRotationKeylist||this.isBinaryType&&(this._m_hasRotationKeylist=0!=(1&this.u)),this._m_hasRotationKeylist}}),Object.defineProperty(t.prototype,"translationInterpolationType",{get:function(){return void 0!==this._m_translationInterpolationType||this.isBinaryType&&(this._m_translationInterpolationType=this.u>>>9&127),this._m_translationInterpolationType}}),Object.defineProperty(t.prototype,"hasTranslationKeylist",{get:function(){return void 0!==this._m_hasTranslationKeylist||this.isBinaryType&&(this._m_hasTranslationKeylist=0!=(this.u>>>1&1)),this._m_hasTranslationKeylist}}),Object.defineProperty(t.prototype,"isAsciiType",{get:function(){return void 0!==this._m_isAsciiType||(this._m_isAsciiType=1213481296==this.u),this._m_isAsciiType}}),Object.defineProperty(t.prototype,"isBinaryType",{get:function(){return void 0!==this._m_isBinaryType||(this._m_isBinaryType=this.u>>>16==4097),this._m_isBinaryType}}),t}(),a=e.Form3d=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.ax=this._io.readF4le(),this.ay=this._io.readF4le(),this.az=this._io.readF4le(),this.bx=this._io.readF4le(),this.by=this._io.readF4le(),this.bz=this._io.readF4le(),this.cx=this._io.readF4le(),this.cy=this._io.readF4le(),this.cz=this._io.readF4le(),this.translation=new v(this._io,this,this._root)},t}(),o=e.MotionSubfile=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.motionFileType=t.bytesToStr(this._io.readBytes(4),"ASCII"),this.motionFileVersion=this._io.readU4le(),this.u=this._io.readU4le(),"MTNB"==this.motionFileType&&(this.name=t.bytesToStr(this._io.readBytes(this.nameLength),"ASCII")),2==this.nodeType&&"MTNB"==this.motionFileType&&(this.leaf=new g(this._io,this,this._root))},Object.defineProperty(e.prototype,"maintainNames",{get:function(){return void 0!==this._m_maintainNames||(this._m_maintainNames=65536&this.u),this._m_maintainNames}}),Object.defineProperty(e.prototype,"nameLength",{get:function(){return void 0!==this._m_nameLength||(this._m_nameLength=65535&this.u),this._m_nameLength}}),Object.defineProperty(e.prototype,"nodeType",{get:function(){return void 0!==this._m_nodeType||(this._m_nodeType=this.u>>>24),this._m_nodeType}}),e}(),r=e.Normal=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.normal=new v(this._io,this,this._root),this.levelOfDetailMask=this._io.readS1(),this.boneIndex=this._io.readS2le()},t}(),s=e.SkinVertex=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.point=new v(this._io,this,this._root),this.xu=this._io.readF4le(),this.xv=this._io.readF4le(),this.levelOfDetailMask=this._io.readS1(),this.boneIndex=this._io.readS2le()},t}(),h=e.StringBlockBinaryFileHeader=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.count=this._io.readS4le(),this.blockSize=this._io.readU4le(),this.content=t.bytesToStr(this._io.readBytes(this.blockSize),"ASCII")},e}(),c=e.Bitmap=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){if(this.bitmapTag=t.bytesToStr(this._io.readBytes(4),"ASCII"),this.bitmapVerion=this._io.readU1(),this.flags=this._io.readU1(),this.format=this._io.readU1(),this.b=this._io.readU1(),0!=this.infoWhAreLog2&&(this.logb=this._io.readU1()),0==this.infoWhAreLog2&&0!=this.infoIfNotLog2AreByte&&(this.bytew=this._io.readU1()),0==this.infoWhAreLog2&&0!=this.infoIfNotLog2AreByte&&(this.byteh=this._io.readU1()),0==this.infoWhAreLog2&&0==this.infoIfNotLog2AreByte&&(this.width=this._io.readU2le()),0==this.infoWhAreLog2&&0==this.infoIfNotLog2AreByte&&(this.height=this._io.readU2le()),this.infoHasCk)switch(this.format){case 1:this.colorKey=this._io.readU1();break;case 10:this.colorKey=this._io.readBitsIntBe(24)}0!=this.infoHasPal&&(this.pallete=new m(this._io,this,this._root)),this.bitmapData=[];do{var e=new l(this._io,this,this._root);this.bitmapData.push(e)}while(!(e.mip>this.maximumMip))},Object.defineProperty(e.prototype,"infoHasCk",{get:function(){return void 0!==this._m_infoHasCk||(this._m_infoHasCk=0!=(2&this.flags)),this._m_infoHasCk}}),Object.defineProperty(e.prototype,"seekMipCount",{get:function(){return void 0!==this._m_seekMipCount||(this._m_seekMipCount=15&this.b),this._m_seekMipCount}}),Object.defineProperty(e.prototype,"infoHasAlpha",{get:function(){return void 0!==this._m_infoHasAlpha||(this._m_infoHasAlpha=4&this.flags),this._m_infoHasAlpha}}),Object.defineProperty(e.prototype,"infoHasPal",{get:function(){return void 0!==this._m_infoHasPal||(this._m_infoHasPal=8&this.flags),this._m_infoHasPal}}),Object.defineProperty(e.prototype,"logh",{get:function(){return void 0!==this._m_logh||(this._m_logh=1<<(15&this.logb)),this._m_logh}}),Object.defineProperty(e.prototype,"maximumMip",{get:function(){return void 0!==this._m_maximumMip||(this._m_maximumMip=this.b>>>4&15),this._m_maximumMip}}),Object.defineProperty(e.prototype,"infoWhAreLog2",{get:function(){return void 0!==this._m_infoWhAreLog2||(this._m_infoWhAreLog2=1&this.flags),this._m_infoWhAreLog2}}),Object.defineProperty(e.prototype,"infoIfNotLog2AreByte",{get:function(){return void 0!==this._m_infoIfNotLog2AreByte||(this._m_infoIfNotLog2AreByte=32&this.flags),this._m_infoIfNotLog2AreByte}}),Object.defineProperty(e.prototype,"logw",{get:function(){return void 0!==this._m_logw||(this._m_logw=1<<(this.logb>>>4&15)),this._m_logw}}),e}(),l=e.BitmapData=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){if(this.mipflags=this._io.readU1(),this.mip<=this._parent.maximumMip){this.bitmap=[];for(var t=0;t<(0!=this._parent.infoWhAreLog2?(this._parent.logw+(1<<this.mip)-1>>>this.mip)*(this._parent.logh+(1<<this.mip)-1>>>this.mip):0!=this._parent.infoIfNotLog2AreByte?(this._parent.bytew+(1<<this.mip)-1>>>this.mip)*(this._parent.byteh+(1<<this.mip)-1>>>this.mip):(this._parent.height+(1<<this.mip)-1>>>this.mip)*(this._parent.width+(1<<this.mip)-1>>>this.mip));t++)switch(this._parent.format){case 1:this.bitmap.push(this._io.readU1());break;case 10:this.bitmap.push(this._io.readBitsIntBe(24))}}},Object.defineProperty(t.prototype,"mip",{get:function(){return void 0!==this._m_mip||(this._m_mip=15&this.mipflags),this._m_mip}}),Object.defineProperty(t.prototype,"mipFlagCompressed",{get:function(){return void 0!==this._m_mipFlagCompressed||(this._m_mipFlagCompressed=16&this.mipflags),this._m_mipFlagCompressed}}),t}(),d=e.MotionBinaryHeader=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.pathCount=this._io.readS4le(),this.nameChecksum=this._io.readS4le(),this.flags=this._io.readS4le()},Object.defineProperty(t.prototype,"hasEvents",{get:function(){return void 0!==this._m_hasEvents||(this._m_hasEvents=1&this.flags),this._m_hasEvents}}),Object.defineProperty(t.prototype,"hasNameArray",{get:function(){return void 0!==this._m_hasNameArray||(this._m_hasNameArray=2&this.flags),this._m_hasNameArray}}),t}(),u=e.Bone=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.boundingBoxMin=new v(this._io,this,this._root),this.boundingBoxMax=new v(this._io,this,this._root),this.attachmentMatrix=new a(this._io,this,this._root),this.parentBoneIndex=this._io.readS2le()},t}(),p=e.StringblockFrombinary=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.stringBlockBinaryFileHeader=new h(this._io,this,this._root)},t}(),m=e.Pallete=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){if(this.flags=this._io.readU1(),0==this.palleteInfoFlagSize256&&(this.numData=this._io.readU1()),0==this.palleteInfoFlagSize256){this.data=[];for(var t=0;t<this.numData;t++)this.data.push(this._io.readU4le())}if(0!=this.palleteInfoFlagSize256)for(this.data256=[],t=0;t<256;t++)this.data256.push(this._io.readU4le())},Object.defineProperty(t.prototype,"palleteInfoFormatMask",{get:function(){return void 0!==this._m_palleteInfoFormatMask||(this._m_palleteInfoFormatMask=31&this.flags),this._m_palleteInfoFormatMask}}),Object.defineProperty(t.prototype,"palleteInfoFlagCompress",{get:function(){return void 0!==this._m_palleteInfoFlagCompress||(this._m_palleteInfoFlagCompress=64&this.flags),this._m_palleteInfoFlagCompress}}),Object.defineProperty(t.prototype,"palleteInfoFlagSize256",{get:function(){return void 0!==this._m_palleteInfoFlagSize256||(this._m_palleteInfoFlagSize256=32&this.flags),this._m_palleteInfoFlagSize256}}),t}(),f=e.TranslationKeylist=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.blockSize=this._io.readS4le(),this.u=this._io.readU4le(),this.count=this._io.readU4le(),this.block=[];for(var t=0;t<Math.floor(this.blockSize/4)-2;t++)this.block.push(this._io.readF4le())},Object.defineProperty(t.prototype,"interpolationType",{get:function(){return void 0!==this._m_interpolationType||(this._m_interpolationType=this.u>>>16&255),this._m_interpolationType}}),Object.defineProperty(t.prototype,"compression",{get:function(){return void 0!==this._m_compression||(this._m_compression=this.u>>>8&255),this._m_compression}}),Object.defineProperty(t.prototype,"looping",{get:function(){return void 0!==this._m_looping||(this._m_looping=1&this.u),this._m_looping}}),t}(),y=e.BodyTriangle=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.vtxIndex=[];for(var t=0;t<3;t++)this.vtxIndex.push(this._io.readS2le());for(this.normalIndex=[],t=0;t<3;t++)this.normalIndex.push(this._io.readS2le());this.materialIndex=this._io.readS2le()},t}(),g=e.Leaf=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.motionBinaryHeader=new d(this._io,this,this._root),0!=this.motionBinaryHeader.hasNameArray&&(this.nameArray=new w(this._io,this,this._root)),this.pathArray=[];for(var t=0;t<this.motionBinaryHeader.pathCount;t++)this.pathArray.push(new n(this._io,this,this._root))},t}(),b=e.Material=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.r=this._io.readF4le(),this.g=this._io.readF4le(),this.b=this._io.readF4le()},t}(),v=e.Vector3=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.x=this._io.readF4le(),this.y=this._io.readF4le(),this.z=this._io.readF4le()},t}(),_=e.RotationKeylist=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.blockSize=this._io.readS4le(),this.u=this._io.readU4le(),this.count=this._io.readU4le(),this.block=[];for(var t=0;t<Math.floor(this.blockSize/4)-2;t++)this.block.push(this._io.readF4le())},Object.defineProperty(t.prototype,"interpolationType",{get:function(){return void 0!==this._m_interpolationType||(this._m_interpolationType=this.u>>>16&255),this._m_interpolationType}}),Object.defineProperty(t.prototype,"compression",{get:function(){return void 0!==this._m_compression||(this._m_compression=this.u>>>8&255),this._m_compression}}),Object.defineProperty(t.prototype,"looping",{get:function(){return void 0!==this._m_looping||(this._m_looping=1&this.u),this._m_looping}}),t}(),w=e.Stringblock=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.stringBlockFileType=t.bytesToStr(this._io.readBytes(4),"ASCII"),"SBKB"===this.stringBlockFileType&&(this.body=new p(this._io,this,this._root))},e}(),k=e.SkinFaces=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.numFaceArray=this._io.readU4le(),this._raw_faceArray=[],this.faceArray=[];for(var e=0;e<this.numFaceArray;e++){this._raw_faceArray.push(this._io.readBytes(14));var i=new t(this._raw_faceArray[e]);this.faceArray.push(new y(i,this,this._root))}},e}();return e}()})?n.apply(e,a):n)||(t.exports=o)},161:function(t,e,i){},162:function(t,e,i){},191:function(t,e){},192:function(t,e){},195:function(t,e){},197:function(t,e){},222:function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"Blog",(function(){return on})),i.d(n,"Text",(function(){return rn})),i.d(n,"Lang",(function(){return sn}));var a={};i.r(a),i.d(a,"Blog",(function(){return hn})),i.d(a,"Text",(function(){return cn})),i.d(a,"Lang",(function(){return ln}));var o,r,s=i(12),h=i.n(s),c=i(128),l=i.n(c),d=(i(161),i(21)),u=(i(162),i(37)),p=i(17),m=i(18),f=i(8),y=m.a.div(o||(o=Object(p.a)(["\n    position: fixed;\n    pointer-events: all;\n    bottom: 12px;\n    left: 12px;\n    z-index: 1001;\n    cursor: pointer;\n"]))),g=m.a.a(r||(r=Object(p.a)(["\n    text-decoration: none;\n    background-color: #003087;\n    color: white;\n    width: auto;\n    height: 52px;\n    display: block;\n    float: right;\n    text-align: center;\n    line-height: 50px;\n    font-weight: bold;\n    border-radius: 12px;\n    margin-left: 8px;\n    padding-left: 14px;\n    padding-right: 14px;\n"]))),b=function(){var t=window.mobileCheck();return Object(f.jsxs)(y,{children:[Object(f.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://www.buymeacoffee.com/jildert",children:Object(f.jsx)("img",{alt:"donation button",src:"https://img.buymeacoffee.com/button-api/?text=Coffee!&emoji=&slug=jildert&button_colour=f87808&font_colour=001000&font_family=Poppins&outline_colour=000000&coffee_colour=FFDD00"})}),Object(f.jsx)(g,{target:"_blank",rel:"noreferrer",href:"https://www.paypal.com/donate/?hosted_button_id=UTG5L7XCF2MPG",children:t?"PayPal":"Donate with Paypal"})]})},v=i(40),_=i(132),w=i(36),k=i(15),x=i(16),j=i(66),S=i(29),O=i(26),A=i(34),T=i(35),L=i(0),P=i(27),M=i(6);function I(t,e){var i=t.indexOf(e);return i>-1&&t.splice(i,1),t}function E(t,e,i){return Math.min(Math.max(t,e),i)}var C,R=i(69),F=i.n(R),D=function(t,e,i){if(!e.open){e.open=!0;var n=new M.e.Quaternion;n.setFromAxisAngle(new M.e.Vector3(0,1,0),(i?-1:1)*Math.PI/2.5),e.targetQuaternion=n,t.playerController.playDoorSound()}},N=function(t,e){if(!e.open){e.open=!0;var i=new M.e.Vector3,n=1e5,a=0;(a=e.geometry.boundingBox.max.x-e.geometry.boundingBox.min.x)<n&&(n=a,i.set(0,0,1)),(a=e.geometry.boundingBox.max.y-e.geometry.boundingBox.min.y)<n&&(n=a,i.set(0,1,0)),(a=e.geometry.boundingBox.max.z-e.geometry.boundingBox.min.z)<n&&(n=a,i.set(1,0,0)),e.targetPosition=e.position.clone().add(i.multiplyScalar(70)),t.playerController.playDoorSound()}},B=function(t){t.playerController.killedByWater=!0,t.playerController.die()},z=function(t,e){if(!e.pressed){e.pressed=!0,e.targetPosition=new M.e.Vector3(e.position.x,e.position.y-80,e.position.z);var i=t.scene.getObjectByName("trap01");i.targetPosition=new M.e.Vector3(i.position.x,i.position.y,i.position.z+160)}},G={knopbridge:function(t,e){var i=t.scene.getObjectByName("ophaalbrug01");if(!e.pressed){t.playerController.playButtonSound();var n=t.playerController.playSound("LV2snd1.WAV",!0);i.onTarget=function(){return n.stop()}}var a=new M.e.Quaternion;a.setFromAxisAngle(new M.e.Vector3(0,0,0),0),i.targetQuaternion=a},"wkcrate.act":function(t,e){e.parent.remove(e),t.physics.destroy(e.body)},knopgate01:function(t,e){if(!e.pressed){e.targetPosition=new M.e.Vector3(e.position.x-6,e.position.y,e.position.z),t.playerController.playButtonSound();var i=t.scene.getObjectByName("fence");i.targetPosition=new M.e.Vector3(i.position.x,i.position.y+100,i.position.z)}},knop:function(t,e){e.pressed||(e.targetPosition=new M.e.Vector3(e.position.x+6,e.position.y,e.position.z),t.playerController.playButtonSound(),D(t,t.scene.getObjectByName("knopdeur_r"),!0),D(t,t.scene.getObjectByName("knopdeur_l"),!1))},schietknop:function(t,e){if(!e.pressed){t.playerController.playButtonSound();var i=[];i.push(t.scene.getObjectByName("stone1")),i.push(t.scene.getObjectByName("stone2")),i.push(t.scene.getObjectByName("stone3")),i.forEach((function(t){t.moved||(t.moved=!0,t.targetPosition=new M.e.Vector3(t.position.x,t.position.y+80,t.position.z))}))}},knopdisc01:function(t,e){e.pressed||t.playerController.playButtonSound();var i=t.scene.getObjectByName("disc"),n=new M.e.Quaternion;n.setFromAxisAngle(new M.e.Vector3(0,1,0),Math.PI/2),i.targetQuaternion=n},vlakvoortrap01:function(t,e){return z(t,e)}},U={right_ingang:function(t,e){return D(t,e,!0)},left_ingang:function(t,e){return D(t,e,!1)},right_ingang_2:function(t,e){return D(t,e,!1)},left_ingang_2:function(t,e){return D(t,e,!0)},knop:G.knop,knopgate01:G.knopgate01,knopbridge:G.knopbridge,Mesh_0_12:function(t){return 0===window.levelIndex&&B(t)},Mesh_0001_48:function(t){return 1===window.levelIndex&&B(t)},doorhallwayXX_XX:function(t,e){return N(t,e)},doorarmoryXX:function(t,e){return N(t,e)},doorwall01:function(t,e){return D(t,e,!1)},doorwall02:function(t,e){return D(t,e,!0)},doorthroneoutside01:function(t,e){return D(t,e,!1)},doorthroneoutside02:function(t,e){return D(t,e,!0)},doorthrone01:function(t,e){return D(t,e,!1)},doorthrone02:function(t,e){return D(t,e,!0)},vlakvoortrap01:function(t,e){return z(t,e)},doorstorage02:function(t,e){return N(t,e)},"savepilarfloor.act":function(t,e){return function(t,e){if(!e.pressed){var i=new M.e.Vector3;e.getWorldPosition(i);var n=e.rotation.z,a=Math.sin(2*Math.PI*n/360),o=Math.cos(2*Math.PI*n/360);i.x+=2*a,i.y+=2*o,localStorage.setItem("position"+window.level,JSON.stringify(i))}}(0,e)}},W=function(){function t(){Object(k.a)(this,t),this.actors=[],this.targetWorldPosition=new M.e.Vector3,this.actorWorldPosition=new M.e.Vector3,this.cameraWorldDirection=new M.e.Vector3,this.cameraWorldPosition=new M.e.Vector3,this.objDirection=new M.e.Vector3,this.camera=null,this.target=null,this.scene=null,this.playerController=null,this.physics=null,this.aimLockedObject=null,this.raycaster=new M.e.Raycaster,this.firstRender=!0}return Object(x.a)(t,[{key:"add",value:function(t){var e=this,i=t.mesh,n=t.motions,a=t.mixer,o=t.shootable,r=t.startMotion,s=t.update;r&&(r.action.loop=M.e.Loop,r.action.play());var h={mesh:i,mixer:a,shootable:o,motions:n,update:s};this.actors.push(h),i.takeHit||(i.takeHit=G[i.name]?function(){G[i.name](e,i),i.pressed=!0}:function(){})}},{key:"reset",value:function(){this.actors=[],this.aimLockedObject=null}},{key:"remove",value:function(t){var e=this.actors.find((function(e){return e.mesh===t}));I(this.actors,e)}},{key:"collide",value:function(t,e){U[e||t.name]&&(U[e||t.name](this,t),t.pressed=!0)}},{key:"calculateDistances",value:function(){this.target.getWorldPosition(this.targetWorldPosition);var t,e=Object(P.a)(this.actors);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.mesh.getWorldPosition(this.actorWorldPosition),i.distance=this.actorWorldPosition.distanceTo(this.targetWorldPosition)}}catch(n){e.e(n)}finally{e.f()}this.actors.sort((function(t,e){return t.distance-e.distance})),this.scene.childrenToCheck=this.scene.children.filter((function(t){return t.visible&&!t.isItem&&!t.name.includes("act")}))}},{key:"logicUpdate",value:function(t){if(this.camera&&this.scene&&this.physics&&this.target){this.calculateDistances();var e,i=Object(P.a)(this.actors);try{for(i.s();!(e=i.n()).done;){var n,a=e.value;if(a.distance<=100)null===(n=a.mixer)||void 0===n||n.update(t)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"update",value:function(t){if(this.camera&&this.scene&&this.physics&&this.target)if(this.firstRender)this.firstRender=!1;else{this.camera.getWorldPosition(this.cameraWorldPosition),this.target.getWorldPosition(this.targetWorldPosition);var e=!1;this.aimLockedObject=null;var i,n=0,a=Object(P.a)(this.actors);try{for(a.s();!(i=a.n()).done;){var o,r=i.value,s=r.mesh,h=r.shootable,c=r.distance,l=r.update;if(null!==(o=s.parent)&&void 0!==o&&o.isNpc&&(n<12?(s.parent.castShadow=!0,s.castShadow=!0,n++):(s.parent.castShadow=!1,s.castShadow=!1)),s.isTrigger)s.visible=!1;else{if(s.targetQuaternion){var d=s.quaternion,u=s.targetQuaternion,p=Math.abs(d.x-u.x)+Math.abs(d.y-u.y)+Math.abs(d.z-u.z)+Math.abs(d.w-u.w);p<.001?(s.quaternion.copy(s.targetQuaternion),s.targetQuaternion=null,s.onTarget&&s.onTarget()):s.quaternion.slerp(s.targetQuaternion,E(.15/p*t*3,0,1)),s.traverse((function(t){t.body&&(t.body.needUpdate=!0)}))}if(s.targetPosition){var m=s.targetPosition.distanceTo(s.position);m<.001?(s.position.set(s.targetPosition.x,s.targetPosition.y,s.targetPosition.z),s.targetPosition=null,s.onTarget&&s.onTarget()):s.position.lerp(s.targetPosition,E(.15/m*t*200,0,1)),s.traverse((function(t){t.body&&(t.body.needUpdate=!0)}))}if(c<=100){if(s.visible=!0,l&&l(t),h&&(this.aimLockedObject===s&&(this.aimLockedObject=null),!e&&!s.dead)){var f;if(this.camera.getWorldDirection(this.cameraWorldDirection),s.getWorldPosition(this.actorWorldPosition),null!==(f=s.geometry)&&void 0!==f&&f.boundingBox){var y=s.geometry.boundingBox.max.y+s.geometry.boundingBox.min.y;this.actorWorldPosition.y-=y/4}if(this.objDirection.subVectors(this.cameraWorldPosition,this.actorWorldPosition).normalize(),Math.abs(this.cameraWorldDirection.dot(this.objDirection))>.99){var g=this.cameraWorldPosition.distanceTo(this.targetWorldPosition);if(g>60)return!1;this.raycaster.far=g,this.raycaster.camera=this.camera;var b=new M.e.Vector3;b.subVectors(this.targetWorldPosition,this.cameraWorldPosition).normalize(),this.raycaster.set(this.cameraWorldPosition,b);var v=this.raycaster.intersectObjects(this.scene.children.filter((function(t){return t.visible&&!t.isItem})),!1);(0===v.length||v[0].object===s||v[0].object.getObjectByName(s.name)||s.getObjectByName(v[0].object.name))&&(e=!0,this.aimLockedObject=s)}}}else s.visible=!1}}}catch(_){a.e(_)}finally{a.f()}}}}],[{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}]),t}(),H=i(1),V=i(2),K=function(){function t(e,i,n,a,o,r){Object(H.a)(this,t),this.texture=e,this.tilesHorizontal=i,this.tilesVertical=n,this.numberOfTiles=a,e.wrapS=e.wrapT=L.RepeatWrapping,e.repeat.set(1/this.tilesHorizontal,1/this.tilesVertical),this.tileDisplayDuration=o,this.currentDisplayTime=0,this.currentTile=0,this.completeCallback=r,this.totalTime=0}return Object(V.a)(t,[{key:"reset",value:function(){this.currentTile=0,this.currentDisplayTime=0}},{key:"update",value:function(t){for(this.currentDisplayTime+=t,this.totalTime+=t;this.currentDisplayTime>this.tileDisplayDuration;){this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.completeCallback&&this.currentTile>=this.numberOfTiles&&this.completeCallback(),this.currentTile===this.numberOfTiles&&(this.currentTile=0);var e=this.currentTile%this.tilesHorizontal;this.texture.offset.x=e/this.tilesHorizontal;var i=Math.floor(this.currentTile/this.tilesHorizontal);this.texture.offset.y=i/this.tilesVertical}}}]),t}(),X=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(k.a)(this,t),this.lightManager=e.lightManager,this.createFireBall(),this.createExplosion(),this.fireballs=[],this.exposions=[],this.scene=e.scene,this.physics=e.physics,this.isPlayer=i,this.camera=e.camera,this.player=e.player,this.maxFireBallDistance=120,this.raycaster=new M.e.Raycaster,this.raycaster.camera=this.camera,this.raycaster.far=this.maxFireBallDistance}return Object(x.a)(t,[{key:"createFireBall",value:function(){var t=(new M.e.TextureLoader).load("fireballs\\electric\\spritesheet.png"),e=new M.e.SpriteMaterial({color:16777215,alphaMap:t,transparent:!0}),i=new M.e.Group,n=new M.e.Sprite(e);i.add(new M.e.Sprite(e)),i.sprite=n,i.visible=!1,this.fireball=i}},{key:"createExplosion",value:function(){var t=(new M.e.TextureLoader).load("fireballs\\explosion\\spritesheet.png"),e=(new M.e.TextureLoader).load("fireballs\\explosion\\spritesheet_a.png"),i=new M.e.SpriteMaterial({color:16777215,alphaMap:e,map:t,transparent:!0}),n=new M.e.Group;n.add(new M.e.Sprite(i)),n.visible=!1,this.explosion=n}},{key:"spawnFireBall",value:function(){var t=this.fireball.clone();this.fireBallLight=this.lightManager.createLightPlaceHolder(14463317,1,10,2),t.light=this.fireBallLight,t.add(this.fireBallLight);var e=new M.e.Vector3;this._target.getWorldPosition(e),t.position.set(e.x,e.y,e.z);var i=null;if(this.isPlayer&&W.getInstance().aimLockedObject){console.log(W.getInstance().aimLockedObject);var n=new M.e.Vector3,a=(new M.e.Box3).setFromObject(W.getInstance().aimLockedObject).getSize(new M.e.Vector3).y;W.getInstance().aimLockedObject.getWorldPosition(n),n.y+=a/4,t.lookAt(n),i=n}else if(this.isPlayer){var o=new M.e.Quaternion;this.player.getWorldQuaternion(o),t.setRotationFromQuaternion(o)}else{var r=new M.e.Vector3;this.player.getWorldPosition(r),t.lookAt(r)}this.isPlayer&&(t.translateX(-.5),i&&t.lookAt(i)),t.translateZ(1),t.visible=!0,t.spawnPoint=e,this.scene.add(t),this.playSound("shoot/RcShoot1.wav"),t.children[0].material=t.children[0].material.clone(),t.children[0].material.alphaMap=t.children[0].material.alphaMap.clone();var s=new K(t.children[0].material.alphaMap,6,1,6,100);t.animator=s,this.fireballs.push(t)}},{key:"spawnExplosion",value:function(t,e){var i=this;this.playSound("shoot/RcShoot4.wav"),console.log(e);var n=e[0].point,a=this.explosion.clone();a.position.set(n.x,n.y,n.z),a.rotation.set(this._target.rotation.x,this._target.rotation.y,this._target.rotation.z),a.translateZ(-1),a.visible=!0,this.scene.add(a),this.exposions.push(a);var o,r=Object(P.a)(e);try{for(r.s();!(o=r.n()).done;){var s,h,c,l=o.value;if(null!==(s=l.object)&&void 0!==s&&s.takeHit){l.object.takeHit();break}if(null!==(h=l.object)&&void 0!==h&&null!==(c=h.parent)&&void 0!==c&&c.takeHit){var d,u;null===(d=l.object)||void 0===d||null===(u=d.parent)||void 0===u||u.takeHit();break}}}catch(f){r.e(f)}finally{r.f()}a.children[0].material=a.children[0].material.clone(),a.children[0].material.map=a.children[0].material.map.clone(),a.children[0].material.alphaMap=a.children[0].material.alphaMap.clone();var p=new K(a.children[0].material.map,8,1,8,100,(function(){a.visible=!1,I(i.exposions,a),i.lightManager.remove(a.light)})),m=new K(a.children[0].material.alphaMap,8,1,8,100);this.explosionLight=this.lightManager.createLightPlaceHolder(14463317,1,10,2),a.light=this.explosionLight,a.add(a.light),a.update=function(t){p.update(1e3*t),m.update(1e3*t),a.light.intensity=Math.max(0,1-p.totalTime/1e3-.2)},this.totalTimeInSeconds=0}},{key:"update",value:function(t){var e=this;this.fireballs.forEach((function(i){i.position.distanceTo(i.spawnPoint)>e.maxFireBallDistance&&(i.visible=!1),i.previousPosition=i.position.clone(),i.translateZ(100*t);var n=new M.e.Vector3;n.subVectors(i.spawnPoint,i.position).normalize(),e.raycaster.set(i.position,n),e.raycaster.far=i.position.distanceTo(i.previousPosition);var a=e.raycaster.intersectObjects(e.scene.children).filter((function(t){var e,i,n;return((null===t||void 0===t||null===(e=t.object)||void 0===e?void 0:e.visible)||(null===t||void 0===t||null===(i=t.object)||void 0===i?void 0:i.isCollider))&&"Sprite"!==(null===t||void 0===t||null===(n=t.object)||void 0===n?void 0:n.type)})).filter((function(t){return!function(t,e){if(!e)return!1;if(t===e)return!0;for(var i=e.parent;i;){if(i===t)return!0;i=i.parent}return!1}(e._target,null===t||void 0===t?void 0:t.object)}));a.length>0&&(e.spawnExplosion(i,a),i.visible=!1),i.animator.update(1e3*t)})),this.fireballs.filter((function(t){return!t.visible})).forEach((function(t){I(e.fireballs,t),e.lightManager.remove(t.light),e.scene.remove(t)})),this.exposions.forEach((function(e){e.update(t)}))}}]),t}(),Y=[{position:[-59.5,-1,113.6],rotation:180},{position:[-17.422975580726522,-.8288705878629896,122.02121613987042],rotation:-20},{position:[80.47956591799108,.8689635992050182,189.72648390379928]},{position:[-8.741,2.563,78.9245]},{position:[-6.0918,124.54,20.5406]}],J={FORWARD:0,LEFT:1,RIGHT:2,BACKWARD:3,JUMP:4,SPRINT:5,SHOOT:6},q="ontouchstart"in window,Q=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(t,n,a,o){var r,s;return Object(k.a)(this,i),(s=e.call(this,n,!0)).input=q?new Z(a):new $(a),s.stateMachine=new et(null!==(r=t.animations)&&void 0!==r?r:{},s.input,Object(j.a)(s),t),s._target=t,s._decceleration=new L.Vector3(-5e-4,-1e-4,-5),s._acceleration=new L.Vector3(1,.25,25),s._velocity=new L.Vector3(0,0,0),s._backwardSpeed=.5,s.camera=n.camera,s.isStrafe=0,s.jumpDelay=10,s.worldObject=o,s.dead=!1,s.hp=100,t.children[0].takeHit=function(){return s.takeHit()},s.audioLoader=new L.AudioLoader,s.audioListener=new L.AudioListener,s.camera.add(s.audioListener),["shoot/RcShoot1.wav","shoot/RcShoot4.wav","rcjump1.wav","Rcwalk1.wav","Switch3.WAV","RcGen1.wav"].forEach((function(t){s.createSound(t)})),s.shootAction=s._target.animations.shoot1.action,s.hitAction=s._target.animations.hit.action,s.spawnAction=s._target.animations["re-spawn"].action,s.shootDebounce=function(t){var e,i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];clearTimeout(e),e=setTimeout((function(){t.apply(i,o)}),n)}}((function(){s.shootAction.fadeOut(.25)}),900),window.playerDie=function(){return s.die()},s.isJumping=!1,s}return Object(x.a)(i,[{key:"AnimateSpawn",value:function(){var t=this;this.blockInput=!0,this.spawnAction.reset(),this.spawnAction.loop=L.LoopOnce,this.spawnAction.setEffectiveTimeScale(1),this.spawnAction.setEffectiveWeight(10),this.spawnAction.fadeIn(.25),this.spawnAction.play(),setTimeout((function(){t.blockInput=!1}),1e3*this.spawnAction._clip.duration)}},{key:"createSound",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new L.Audio(this.audioListener);return this.audioLoader.load("sounds/"+t,(function(a){if(n.setBuffer(a),n.setVolume(.25),3===window.levelIndex){var o=new F.a.Effects.Reverb({time:1.89,decay:1.32,reverse:!1,mix:.5});n.setFilter(o)}i&&n.play(),e.sounds=e.sounds||{},e.sounds[t]=n})),n}},{key:"takeHit",value:function(){this.dead||(this.hitAction.reset(),this.hitAction.loop=L.LoopOnce,this.hitAction.setEffectiveTimeScale(1),this.hitAction.setEffectiveWeight(3),this.hitAction.fadeIn(.25),this.hitAction.play(),this.hp=Math.max(this.hp-50,0),this.playSound("RcGen1.wav"),0===this.hp&&this.die())}},{key:"playSound",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.audioLoader)return null;if(!this.sounds||!this.sounds[t]){console.warn("sound not initialized",t);var n=this.createSound(t,i);return n.setLoop(e),n}var a=this.sounds[t];return a.setLoop(e),i&&a.play(),a}},{key:"takeItem",value:function(t){var e={"ImoneyM.act":{sound:"ICoinM.wav"},"Ipotion.act":{sound:"IPotion.wav"}};console.log(t.name),e[t.name]&&this.playSound(e[t.name].sound)}},{key:"playButtonSound",value:function(){this.playSound("Switch3.WAV")}},{key:"playDoorSound",value:function(){var t,e="OpenDoorNormal.wav";null!==(t=this.sounds[e])&&void 0!==t&&t.isPlaying||this.playSound(e)}},{key:"die",value:function(){var t=this;this.dead||(this.stateMachine.SetState("death"),this.dead=!0,this.playSound("RcGen7.wav"),setTimeout((function(){t.respawn()}),3e3))}},{key:"respawn",value:function(){var t,e=this,i=localStorage.getItem("position"+window.level)&&JSON.parse(localStorage.getItem("position"+window.level)),n=(i?[i.x,i.y,i.z]:null===(t=Y[this.currentLevelIndex])||void 0===t?void 0:t.position)||Y[0].position,a=Object(_.a)(L.Vector3,Object(w.a)(n));this.player.body.setCollisionFlags(2),this.player.position.set(a.x,a.y,a.z),this.player.body.needUpdate=!0,this.player.body.once.update((function(){e.player.body.setCollisionFlags(0),e.player.body.setVelocity(0,0,0),e.player.body.setAngularVelocity(0,1,0)})),this.dead=!1,this.stateMachine.SetState("idle"),this.AnimateSpawn()}},{key:"Update",value:function(t){var e,n,a=this;if(Object(S.a)(Object(O.a)(i.prototype),"update",this).call(this,t),this._target){this.jumpDelay+=1e3*t,this.stateMachine.Update(t),null===(e=this._target.mixer)||void 0===e||e.update(t),null!==(n=this._target)&&void 0!==n&&n.body;var o=this._target;if(this.blockInput)o.body.setVelocity(0,0,0);else if(this.dead){var r;o.body.setVelocityX(0),o.body.setVelocityZ(0),o.body.setAngularVelocity(0,0,0),this.killedByWater&&(null===(r=o.children[0])||void 0===r||r.translateZ(-t))}else{this.jumpDelay<1e3&&(this.jumpDelay+=t),this.input.keyPressed(J.JUMP)&&this.canJump()&&(this.jumpDelay=0,o.body.applyForceY(14),this.playSound("rcjump1.wav"));var s=this.input.keyPressed(J.FORWARD)?1:0,h=this.input.keyPressed(J.LEFT)?1:0,c=this.input.keyPressed(J.RIGHT)?1:0,l=this.input.keyPressed(J.BACKWARD)?1:0;if(s||h||c||l){var d=(this.stateMachine.sprint?10:8)*(window.snel?5:1),u=new L.Vector3,p=o.getWorldDirection(u);p.multiplyScalar(l?-this._backwardSpeed:1);var m=Math.atan2(p.x,p.z),f=Math.sin(m)*d,y=o.body.velocity.y,g=Math.cos(m)*d,b=new L.Vector3(f,y,g);if(h||c||this.input.moveX){var v=new L.Vector3(0,1,0),_=Math.PI/2;s?_-=Math.PI/4:l&&(_-=Math.PI/4,_*=-1),isNaN(this.input.moveX)?(this.input.angle&&(_=this.input.angle),c&&(_*=-1)):_*=-this.input.moveX,b.applyAxisAngle(v,_)}this.input.speed&&b.multiplyScalar(this.input.speed),o.body.setVelocity(b.x,b.y,b.z),this._target.body.velocity.y>0&&this.jumpDelay>=1e3&&(this.isJumping=!1),this.walking=!0}else{var w=o.body.velocity.y;w>7&&(w=7),w>0&&(w-=.1),o.body.setVelocity(0,w,0),this.walking=!1}this.shootDelay>0&&(this.shootDelay-=1e3*t),this.input.keyPressed(J.SHOOT)&&(!this.shootDelay||this.shootDelay<=0)&&!this.fireball.visible&&(this.shootDelay=500,this.shootAction.reset(),this.shootAction.loop=L.LoopOnce,this.shootAction.setEffectiveTimeScale(1),this.shootAction.setEffectiveWeight(3),this.shootAction.fadeIn(.25),this.shootAction.play(),setTimeout((function(){a.spawnFireBall()}),800),this.shootDebounce())}}}},{key:"canJump",value:function(){return this._target.body.velocity.y>0&&this.jumpDelay>=1e3}}]),i}(X),Z=function(){function t(e){Object(k.a)(this,t),this._keysPressed={},this.speed=0,this.angle=0,this.topAngle=0,this.move={x:0,y:0},this.look={x:0,y:0}}return Object(x.a)(t,[{key:"updateMovement",value:function(t,e){t&&(this.move=t),e&&(this.look=e),this._keysPressed[J.FORWARD]=this.move.y>0,this._keysPressed[J.BACKWARD]=this.move.y<0,this._keysPressed[J.LEFT]=this.move.x<-.5,this._keysPressed[J.RIGHT]=this.move.x>.5,this.moveX=this.move.x,this.speed=Math.max(Math.min(Math.abs(this.move.x)+Math.abs(this.move.y),1),0),this.angle=20*-this.look.x,this.topAngle=20*-this.look.y}},{key:"clearAll",value:function(){this._keysPressed={}}},{key:"getAllKeysPressed",value:function(){var t=this;return Object.keys(this._keysPressed).filter((function(e){return t._keysPressed[e]}))}},{key:"keyPressed",value:function(t){return!!this._keysPressed[t]}}]),t}(),$=function(){function t(e){var i,n=this;Object(k.a)(this,t),this._keysPressed={},this.keyMap=(i={},Object(v.a)(i,J.FORWARD,"w"),Object(v.a)(i,J.LEFT,"a"),Object(v.a)(i,J.RIGHT,"d"),Object(v.a)(i,J.BACKWARD,"s"),Object(v.a)(i,J.JUMP," "),Object(v.a)(i,J.SPRINT,"shift"),Object(v.a)(i,J.SHOOT,"lmb"),i),document.addEventListener("keydown",(function(t){return n._onKeyDown(t)})),document.addEventListener("keyup",(function(t){return n._onKeyUp(t)})),e.addEventListener("mousedown",(function(t){return n._onKeyDown({key:"lmb"})})),e.addEventListener("mouseup",(function(t){return n._onKeyUp({key:"lmb"})})),window.addEventListener("blur",(function(t){return n._onBlur(t)}))}return Object(x.a)(t,[{key:"_onBlur",value:function(){this._keysPressed={}}},{key:"clearAll",value:function(){this._keysPressed={}}},{key:"_onKeyDown",value:function(t){this._keysPressed[t.key.toLowerCase()]=!0}},{key:"_onKeyUp",value:function(t){this._keysPressed[t.key.toLowerCase()]=!1}},{key:"getAllKeysPressed",value:function(){var t=this;return Object.keys(this._keysPressed).filter((function(e){return t._keysPressed[e]}))}},{key:"keyPressed",value:function(t){return!!this._keysPressed[this.keyMap[t]]}}]),t}(),tt=function(){function t(e,i,n,a){Object(k.a)(this,t),this._states={},this._currentState=null,this._animations=e,this.input=i,this.controller=n,this.target=a}return Object(x.a)(t,[{key:"_AddState",value:function(t,e){this._states[t]=e}},{key:"SetState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._currentState;if(i){if(i.Name===t&&!e)return;i.Exit()}var n=new this._states[t](this);this._currentState=n,n.Enter(i,this.input)}},{key:"Update",value:function(t){this._currentState&&this._currentState.Update(t,this.input)}}]),t}(),et=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(t,n,a,o){var r;return Object(k.a)(this,i),(r=e.call(this,t,n,a,o))._Init(),r.walkSound=null,r}return Object(x.a)(i,[{key:"_Init",value:function(){this._AddState("idle",nt),this._AddState("walkfw",at),this._AddState("jump",rt),this._AddState("death",ot),this.SetState("idle")}}]),i}(tt),it=function(){function t(e){Object(k.a)(this,t),this._parent=e}return Object(x.a)(t,[{key:"Enter",value:function(){}},{key:"Exit",value:function(){}},{key:"Update",value:function(){}}]),t}(),nt=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(){return Object(k.a)(this,i),e.apply(this,arguments)}return Object(x.a)(i,[{key:"Name",get:function(){return"idle"}},{key:"Enter",value:function(t){var e=this._parent._animations.idle.action;if(t){var i=this._parent._animations[t.Name].action;e.time=0,e.enabled=!0,e.setEffectiveTimeScale(1),e.setEffectiveWeight(1),e.crossFadeFrom(i,.2,!0),e.play()}else e.play()}},{key:"Exit",value:function(){}},{key:"Update",value:function(t,e){e.keyPressed(J.JUMP)&&this._parent.controller.canJump()?this._parent.SetState("jump"):(e.keyPressed(J.FORWARD)||e.keyPressed(J.BACKWARD)||e.keyPressed(J.LEFT)||e.keyPressed(J.RIGHT))&&this._parent.SetState("walkfw")}}]),i}(it),at=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(){return Object(k.a)(this,i),e.apply(this,arguments)}return Object(x.a)(i,[{key:"Name",get:function(){return this.name||"walkfw"}},{key:"getNewName",value:function(){return this._parent.input.keyPressed(J.BACKWARD)?this._parent.input.keyPressed(J.LEFT)?"walkbwl":this._parent.input.keyPressed(J.RIGHT)?"walkbwr":"walkbw":this._parent.input.keyPressed(J.LEFT)?"strafel":this._parent.input.keyPressed(J.RIGHT)?"strafer":"walkfw"}},{key:"Enter",value:function(t){this.name=this.getNewName(),this._parent.walkSound||(this._parent.walkSound=this._parent.controller.playSound("Rcwalk1.wav",!0,!1)),this._parent.walkSound&&!this._parent.walkSound.isPlaying&&this._parent.walkSound.play();var e=this._parent._animations[this.Name].action;if(this.action=e,t){var i=this._parent._animations[t.Name].action;if(e.enabled=!0,"run"===t.Name){var n=e.getClip().duration/i.getClip().duration;e.time=i.time*n}else e.time=0,e.setEffectiveTimeScale(1),e.setEffectiveWeight(1);e.crossFadeFrom(i,.5,!0),e.play()}else e.play()}},{key:"Exit",value:function(){var t;null===(t=this._parent.walkSound)||void 0===t||t.stop()}},{key:"Update",value:function(t,e){this.name!==this.getNewName()&&this._parent.SetState("walkfw",!0),e.keyPressed(J.JUMP)&&this._parent.controller.canJump()?this._parent.SetState("jump"):(this._parent.sprint=!1,this.action.setEffectiveTimeScale(1.2),e.keyPressed(J.FORWARD)||e.keyPressed(J.BACKWARD)||e.keyPressed(J.LEFT)||e.keyPressed(J.RIGHT)?e.keyPressed(J.SPRINT)&&(this._parent.sprint=!0,this.action.setEffectiveTimeScale(1.5)):this._parent.SetState("idle"))}}]),i}(it),ot=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(){return Object(k.a)(this,i),e.apply(this,arguments)}return Object(x.a)(i,[{key:"Name",get:function(){return"death"}},{key:"Enter",value:function(t){var e=this._parent._animations.death.action;if(t){var i=this._parent._animations[t.Name].action;e.reset(),e.time=0,e.enabled=!0,e.clampWhenFinished=!0,e.loop=L.LoopOnce,e.setEffectiveTimeScale(1),e.setEffectiveWeight(1),e.crossFadeFrom(i,.2,!0),e.play()}else e.play()}},{key:"Exit",value:function(){}},{key:"Update",value:function(t,e){}}]),i}(it),rt=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(){return Object(k.a)(this,i),e.apply(this,arguments)}return Object(x.a)(i,[{key:"Name",get:function(){return"jump1"}},{key:"Enter",value:function(t){this._parent.controller.isJumping=!0;var e=this._parent._animations[this.Name].action;if(e.paused=!1,e.time=0,this.curAction=e,t){var i=this._parent._animations[t.Name].action;e.loop=L.LoopOnce,e.enabled=!0,e.setEffectiveTimeScale(1),e.setEffectiveWeight(1),e.crossFadeFrom(i,.2,!0),e.play()}else e.play()}},{key:"Exit",value:function(){}},{key:"Update",value:function(t,e){this.curAction.enabled?!e.keyPressed(J.JUMP)&&this.curAction.time>.7&&(e.keyPressed(J.FORWARD)||e.keyPressed(J.BACKWARD)?this._parent.SetState("walkfw"):this._parent.SetState("idle")):this._parent.SetState("idle")}}]),i}(it),st=i(104),ht=i.p+"static/media/menu.dd499179.svg",ct=i.p+"static/media/fullscreen.a7debbc6.svg",lt={RESOLUTION_SCALE:"Resolution Scale",MAX_NUMBER_LIGHTS:"Max number of lights",SHADOWS_ENABLED:"Shadows enabled",SHADOW_RESOLUTION:"Shadow quality"},dt=function(){function t(){Object(k.a)(this,t)}return Object(x.a)(t,null,[{key:"Get",value:function(e){return t.Settings[e]}},{key:"Set",value:function(e,i){t.Settings[e]=i,localStorage.setItem(It,JSON.stringify(t.Settings));var n,a=Object(P.a)(t.updateListeners);try{for(a.s();!(n=a.n()).done;){(0,n.value)()}}catch(o){a.e(o)}finally{a.f()}}}]),t}();dt.Settings=(C={},Object(v.a)(C,lt.RESOLUTION_SCALE,1),Object(v.a)(C,lt.MAX_NUMBER_LIGHTS,13),Object(v.a)(C,lt.SHADOWS_ENABLED,!0),Object(v.a)(C,lt.SHADOW_RESOLUTION,256),C),dt.updateListeners=[];var ut,pt,mt,ft,yt,gt,bt,vt,_t,wt,kt,xt,jt,St,Ot,At,Tt,Lt,Pt,Mt,It="USERSETTINGS_REDCAT",Et=m.a.div(ut||(ut=Object(p.a)(["\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    flex-direction: column;\n    max-width: 800px;\n    margin: 0 auto;\n    text-align: center;\n    background-color: #171031;\n    border-radius: 8px;\n    padding-bottom: 16px;\n    overflow-y: scroll;\n    pointer-events: all;\n    max-height: 100%;\n"]))),Ct=m.a.input(pt||(pt=Object(p.a)(["\n    pointer-events: all;\n    width: 500px;\n    max-width: 100%;\n    cursor: pointer;\n"]))),Rt=m.a.span(mt||(mt=Object(p.a)(["\n\n"]))),Ft=m.a.div(ft||(ft=Object(p.a)(["\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    margin: auto;\n    margin-bottom: 18px;\n"]))),Dt=m.a.span(yt||(yt=Object(p.a)(["\n    font-size: 21px;\n    width: 100%;\n    margin-bottom: 24px;\n    margin-top: 6px;\n"]))),Nt=m.a.div(gt||(gt=Object(p.a)(["\n    display: inline-block;\n    background-color: #2f1300;\n    padding: 4px;\n    border-radius: 4px;\n    margin: 4px;\n    cursor: pointer;\n    pointer-events: all;\n    ",";\n"])),(function(t){return t.active?"background-color: #873700;":""})),Bt=function(t){return"boolean"===typeof t?t?"Yes":"No":t},zt=function(t){var e=t.options,i=t.userSetting,n=Object(s.useState)({}),a=Object(u.a)(n,2)[1],o=dt.Get(i);return Object(f.jsx)("div",{children:e.map((function(t){return Object(f.jsx)(Nt,{onClick:function(){return function(t){dt.Set(i,t),a({})}(t)},active:o===t,children:Bt(t)},t)}))})},Gt=function(t){var e=t.project,i=Object(s.useState)(dt.Get(lt.RESOLUTION_SCALE)),n=Object(u.a)(i,2),a=n[0],o=n[1],r=Object(s.useState)(dt.Get(lt.MAX_NUMBER_LIGHTS)),h=Object(u.a)(r,2),c=h[0],l=h[1],d=Object(s.useState)(!1),p=Object(u.a)(d,2),m=p[0],y=p[1],g=Object(s.useState)(!1),b=Object(u.a)(g,2),v=b[0],_=b[1];Object(s.useEffect)((function(){dt.updateListeners=[],dt.updateListeners.push((function(){y(!0)}))}),[]);return Object(f.jsx)("div",{style:{maxHeight:"100%",overflow:"auto",zIndex:1002,width:"100%",marginBottom:8,position:v?"fixed":"initial",height:v?"100%":"initial",top:0,backgroundColor:v?"#0000006b":""},children:Object(f.jsx)(Et,{style:{marginTop:v?8:18},children:v?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(Dt,{children:["Performance Settings ",Object(f.jsx)(Nt,{onClick:function(){return _(!1)},children:"Close"})]}),Object(f.jsxs)(Ft,{children:[Object(f.jsxs)(Rt,{children:["Resolution Scale (",a,")"]}),Object(f.jsx)(Ct,{type:"range",min:"0.2",max:"1",step:"0.05",value:a,onChange:function(t){var i;i=t.target.value,dt.Set(lt.RESOLUTION_SCALE,i),o(i),e.scene.setScale(i),t.stopPropagation(),t.preventDefault()},className:"slider"})]}),Object(f.jsxs)(Ft,{children:[Object(f.jsx)(Rt,{children:"Shadows enabled"}),Object(f.jsx)(zt,{userSetting:lt.SHADOWS_ENABLED,options:[!0,!1]})]}),Object(f.jsxs)(Ft,{children:[Object(f.jsx)(Rt,{children:"Shadow Quality"}),Object(f.jsx)(zt,{userSetting:lt.SHADOW_RESOLUTION,options:[64,128,256,512]})]}),Object(f.jsxs)(Ft,{children:[Object(f.jsxs)(Rt,{children:["Maximum Lights (",c,")"]}),Object(f.jsx)(Ct,{type:"range",min:"0",max:"13",step:"1",value:c,onChange:function(t){var e;e=t.target.value,dt.Set(lt.MAX_NUMBER_LIGHTS,e),l(e),t.stopPropagation(),t.preventDefault()},className:"slider"})]}),m?Object(f.jsxs)("div",{style:{color:"#ff9696"},children:["A game reload is required to apply the settings",Object(f.jsx)(Nt,{onClick:function(){return window.location.reload()},children:"Apply and reload"})]}):null]}):Object(f.jsx)("div",{style:{margin:"auto"},children:Object(f.jsx)(Nt,{onClick:function(){return _(!0)},children:"Open Performance Settings"})})})})},Ut="ontouchstart"in window,Wt=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),Ht=Ut&&Wt,Vt=m.a.div(bt||(bt=Object(p.a)(['\n    background: url("./img/background.jpeg") no-repeat;\n    background-size: contain;\n    background-position: center;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: #061941;\n    flex-direction: column;\n\n    ',"\n"])),(function(t){return t.fadeOut&&"\n        transition: opacity ease-in .25s 0s;\n        opacity: 0;\n    "})),Kt=m.a.div(vt||(vt=Object(p.a)(['\n    background: url("./img/levelbg','.bmp") no-repeat;\n    width: 256px;\n    height: 256px;\n    background-position: center;\n    border: 4px solid #F87808;\n    background-size: contain;\n\n    ',";\n\n    max-width: 18vw;\n    max-height: 18vw;\n"])),(function(t){return t.level}),(function(t){return!t.active&&"border-width: 0px;"})),Xt=m.a.div(_t||(_t=Object(p.a)(["\n    height: 12px;\n    margin-top: 8px;\n    width: 512px;\n"]))),Yt=m.a.div(wt||(wt=Object(p.a)(["\n    width: 0%;\n    height: 12px;\n    background-color: #F87808;\n"]))),Jt=m.a.span(kt||(kt=Object(p.a)(["\n    color: white;\n    margin-top: 12px;\n"]))),qt=m.a.div(xt||(xt=Object(p.a)(["\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n    pointer-events: all;\n    height: auto;\n    flex-basis: 100%;\n    max-width: 100%;\n\n    ",":hover {\n        opacity: 0.8;\n    }\n"])),Kt),Qt=m.a.div(jt||(jt=Object(p.a)(["\n    position: fixed;\n    height: 50%;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-wrap: wrap;\n    pointer-events: all;\n    top: 12px;\n"]))),Zt=m.a.div(St||(St=Object(p.a)(["\n    width: 100%;\n    background-color: #F87808;\n    width: auto;\n    padding: 12px;\n    border-radius: 4px;\n    user-select: none;\n\n    &:hover {\n        opacity: 0.8;\n    }\n"]))),$t=m.a.div(Ot||(Ot=Object(p.a)(["\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    pointer-events: all;\n"]))),te=m.a.div(At||(At=Object(p.a)(["\n    position: fixed;\n    pointer-events: all;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    user-select: none;\n"]))),ee=m.a.div(Tt||(Tt=Object(p.a)(["\n    position: absolute;\n    left: 24px;\n    bottom: 0;\n    width: 200px;\n    height: 140px;\n    opacity: 0.5;\n\n    ","\n"])),(function(t){return t.right&&"\n        right: 24px;\n        left: auto;\n    "})),ie=m.a.div(Lt||(Lt=Object(p.a)(["\n    position: absolute;\n    width: 70px;\n    height: 70px;\n    background-color: white;\n    opacity: 0.5;\n    border-radius: 100%;\n    right: 24px;\n    bottom: 44px;\n    text-align: center;\n    line-height: 69px;\n    color: black;\n    font-weight: bold;\n"]))),ne=0,ae=m.a.div(Pt||(Pt=Object(p.a)(["\n    position: fixed;\n    top: 12px;\n    border-radius: 6px;\n    background-color: white;\n    left: 90px;\n    background-size: cover;\n    width: 22px;\n    height: 22px;\n"]))),oe=m.a.div(Mt||(Mt=Object(p.a)(["\n    width: 6px;\n    height: 6px;\n    top: calc(50% - 3px);\n    left: calc(50% - 3px);\n    position: fixed;\n    background-color: green;\n    border-radius: 100%;\n"]))),re=function(t){var e=t.project,i=t.loadLevel,n=Object(s.useRef)(),a=Object(s.useState)(!1),o=Object(u.a)(a,2),r=o[0],h=o[1],c=Object(s.useState)("Loading.."),l=Object(u.a)(c,2),d=l[0],p=l[1];Object(s.useEffect)((function(){h(!1),n.current.style.width=0,e.scene.loadingProgress=function(t,e){var i=e/100,a=Math.round(t/i);a!==ne&&(ne=a,n.current.style.width=a+"%")},e.scene.loadingMessage=function(t){p(t)},e.scene.loadingComplete=function(){h(!0)}}),[e.scene]);var m=Number(window.level?window.level.substring(11,12):0);return Object(f.jsxs)(f.Fragment,{children:[r?Object(f.jsx)($t,{className:"menu",onClick:function(t){return t.target.className.includes("menu")&&e.scene.onPointerLock()},children:Object(f.jsxs)(Qt,{id:"menu",className:"menu",children:[Object(f.jsxs)(qt,{children:[Object(f.jsx)(Kt,{active:0===m,level:1,onClick:function(){return i(0)}}),Object(f.jsx)(Kt,{active:1===m,level:2,onClick:function(){return i(1)}}),Object(f.jsx)(Kt,{active:2===m,level:3,onClick:function(){return i(2)}}),Object(f.jsx)(Kt,{active:3===m,level:4,onClick:function(){return i(3)}}),Object(f.jsx)(Kt,{active:4===m,level:5,onClick:function(){return i(4)}})]}),Object(f.jsx)(Gt,{project:e}),Object(f.jsx)(Zt,{onClick:function(t){e.scene.onPointerLock()},children:"Continue game"}),Object(f.jsx)(b,{})]})}):null,Ut?Object(f.jsxs)(te,{id:"mobile-controls",children:[Object(f.jsx)(ee,{children:Object(f.jsx)(st.Joystick,{size:100,sticky:!1,baseColor:"white",stickColor:"#c8c8c8",move:function(t){var i=t.x,n=t.y;e.scene.onTouchUpdate({x:i,y:n})},stop:function(){return e.scene.onTouchUpdate({x:0,y:0})}})}),Object(f.jsx)(ee,{right:!0,children:Object(f.jsx)(st.Joystick,{size:100,sticky:!1,baseColor:"white",stickColor:"#c8c8c8",move:function(t){var i=t.x,n=t.y;return e.scene.onTouchUpdate(null,{x:i,y:n})},stop:function(){return e.scene.onTouchUpdate(null,{x:0,y:0})}})}),Object(f.jsx)(ie,{onTouchStart:function(){return e.scene.onInput(J.JUMP)},children:"Jump"}),Object(f.jsx)(ie,{style:{bottom:"150px"},onTouchStart:function(){return e.scene.onInput(J.SHOOT)},children:"Shoot"}),Object(f.jsx)(ae,{onClick:function(){return document.body.classList.add("paused")},style:{backgroundImage:"url("+ht+")"}}),!Ht&&Object(f.jsx)(ae,{onClick:function(){return document.documentElement.requestFullscreen()},style:{backgroundImage:"url("+ct+")",left:125}})]}):null,Object(f.jsxs)(Vt,{fadeOut:r,children:[Object(f.jsx)(Kt,{level:Number(m)+1}),Object(f.jsx)(Jt,{children:d}),Object(f.jsx)(Xt,{children:Object(f.jsx)(Yt,{ref:n})})]}),r&&Object(f.jsx)(oe,{})]})};var se=function(t){var e=t.initialProject,i=t.initScene,n=Object(s.useState)(e),a=Object(d.a)(n,2),o=a[0],r=a[1];return Object(f.jsx)(f.Fragment,{children:Object(f.jsx)(re,{project:o,loadLevel:function(t){o.scene.loadLevel(t),o.scene.dispose(),i((function(t){r(t)}))}})})},he=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,228)).then((function(e){var i=e.getCLS,n=e.getFID,a=e.getFCP,o=e.getLCP,r=e.getTTFB;i(t),n(t),a(t),o(t),r(t)}))},ce=i(11),le=i(24),de=i(133),ue=i.n(de),pe=i(3),me=i(4),fe=function(t){Object(pe.a)(i,t);var e=Object(me.a)(i);function i(t,n){var a;return Object(H.a)(this,i),(a=e.call(this,t,n)).screenSpacePanning=!1,a.mouseButtons={LEFT:L.MOUSE.PAN,MIDDLE:L.MOUSE.DOLLY,RIGHT:L.MOUSE.ROTATE},a.touches={ONE:L.TOUCH.PAN,TWO:L.TOUCH.DOLLY_ROTATE},a}return Object(V.a)(i)}(i(88).a),ye=i(134),ge=i.n(ye),be=i(89),ve=i(54),_e=function(t){return Math.round(1e3*t)/1e3};function we(t,e,i){for(var n=[],a=0;a<i;a++)n.push(e+t*a);return n}var ke={},xe={},je=["wkcrate.act"],Se=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]||je.includes(e),n=["spiderweb.act"].includes(e),a=n,o=new ge.a(new be.KaitaiStream(t)),r=!!ke[e],s=ke[e]||new M.e.BufferGeometry,h=o.body.skinVertexArray,c=o.body.skinNormalArray,l=[],d=[],p=[],m=xe[e]||[];if(0===m.length)for(var f=0;f<o.body.numMaterialArray;f++){for(var y=o.body.bitmaps[f].bitmapData[0].bitmap,g=o.body.bitmaps[f].pallete&&(o.body.bitmaps[f].pallete.data||o.body.bitmaps[f].pallete.data256),b=o.body.bitmaps[f].logw,v=o.body.bitmaps[f].logh,_=new Uint8Array(b*v*4),k=o.body.bitmaps[f].colorKey,x=0,j=0,S=0;S<v;S++)for(var O=0;O<b;O++){var A=y[x],T=void 0,L=void 0,P=void 0,I=void 0;if(I=255,g){var E=g[A];T=E>>16&255,L=E>>8&255,P=255&E,A===k&&(I=0)}else P=A>>16&255,L=A>>8&255,T=255&A,A===k&&(I=0);_[j++]=T,_[j++]=L,_[j++]=P,_[j++]=I,0===I&&(a=!0),x++}var C=new M.e.DataTexture(_,b,v,M.e.RGBAFormat,M.e.UnsignedByteType,M.e.UVMapping,M.e.RepeatWrapping,M.e.RepeatWrapping);C.needsUpdate=!0,window.renderer.initTexture(C);var R=new M.e.MeshLambertMaterial({side:M.e.FrontSide,transparent:a});n?R.alphaMap=C:R.map=C,m.push(R)}xe[e]=m;var F=[],D=[],N=[];var B=function(t,e){var i=new M.e.Vector3(h[t].point.x,h[t].point.y,h[t].point.z);N.push(h[t].xu,h[t].xv);var n=h[t].boneIndex>>8;!function(t,e){for(var i=o.body.boneArray[e];i;){var n=i.attachmentMatrix,a=i.attachmentMatrix.translation,r=new M.e.Matrix4;r.set(n.ax,n.ay,n.az,a.x,n.bx,n.by,n.bz,a.y,n.cx,n.cy,n.cz,a.z,0,0,0,1),i=o.body.boneArray[i.parentBoneIndex],t.applyMatrix4(r)}}(i,n),l.push(n,0,0,0),d.push(1,0,0,0),D.push(i.x,i.y,i.z),F.push(c[e].normal.x,c[e].normal.y,c[e].normal.z)},z=0,G=0,U=o.body.skinFaces.faceArray.length;if(!r){for(var W=0;W<o.body.skinFaces.faceArray.length;W++){var H=o.body.skinFaces.faceArray[W],V=H.materialIndex;V!==z&&(s.addGroup(G,3*W,V),z=V,G=W,U-=W+1),B(H.vtxIndex[0],H.normalIndex[0]),B(H.vtxIndex[1],H.normalIndex[1]),B(H.vtxIndex[2],H.normalIndex[2])}0===z?s.addGroup(0,3*o.body.skinFaces.faceArray.length,0):s.addGroup(3*(o.body.skinFaces.faceArray.length-U-1),3*U,z),s.setAttribute("position",new M.e.Float32BufferAttribute(D,3)),s.setAttribute("uv",new M.e.Float32BufferAttribute(N,2)),s.setAttribute("skinIndex",new M.e.Uint16BufferAttribute(l,4)),s.setAttribute("skinWeight",new M.e.Float32BufferAttribute(d,4)),s.setAttribute("normal",new M.e.Float32BufferAttribute(F,3))}s=ve.a(s),ke[e]=s;var K=o.body.boneNames.body.stringBlockBinaryFileHeader.content.split(" "),X=null;if(0===o.body.boneArray.length)X=new M.e.Mesh(s,m);else{X=new M.e.SkinnedMesh(s,m),s.groups.forEach((function(t,e){t.materialIndex=Math.floor(e%m.length)}));for(var Y=[],J=null,q=0;q<o.body.boneArray.length;q++){var Q=new M.e.Bone,Z=o.body.boneArray[q],$=Z.attachmentMatrix.translation,tt=Z.attachmentMatrix,et=new M.e.Matrix4;et.set(tt.ax,tt.ay,tt.az,$.x,tt.bx,tt.by,tt.bz,$.y,tt.cx,tt.cy,tt.cz,$.z,0,0,0,1),Q.applyMatrix4(et),Q.name="bone_"+q,-1===Z.parentBoneIndex?J=Q:Y[Z.parentBoneIndex].add(Q),Y.push(Q)}var it=new M.e.Skeleton(Y);X.add(J),X.bind(it)}var nt=null;if(o.motionSubfiles&&o.motionSubfiles.length>0){nt=new M.e.AnimationMixer(X);o.motionSubfiles.forEach((function(t){var e,i,n=null===(e=t.name)||void 0===e?void 0:e.slice(0,-1),a=[],r=0;null===(i=t.leaf)||void 0===i||i.pathArray.forEach((function(t,e){var i,n=null===(i=X.skeleton)||void 0===i?void 0:i.bones[e];if(n){var s=n.name,h=function(t,i){var n,a=new M.e.Bone,r=o.body.boneArray[e],s=r.attachmentMatrix,h=r.attachmentMatrix.translation,c=new M.e.Matrix4;if(c.set(s.ax,s.ay,s.az,h.x,s.bx,s.by,s.bz,h.y,s.cx,s.cy,s.cz,h.z,0,0,0,1),t){var l=new M.e.Quaternion(t[1],t[2],t[3],t[0]);a.setRotationFromQuaternion(l)}i&&(i.length,(n=a.position).set.apply(n,Object(w.a)(i)));a.applyMatrix4(c);var d=a.quaternion;return{quaternion:[d.x,d.y,d.z,d.w],position:[a.position.x,a.position.y,a.position.z]}};if(t.hasTranslationKeylist){var c=[],l=[];if(0===t.translationKeylist.compression){var d=t.translationKeylist.block.map((function(t){return _e(t)}));l=d.slice(0,d.length/4).map((function(t){return 1*t}));for(var p=d.slice(d.length/4),m=0;m<p.length;m+=3)c.push.apply(c,Object(w.a)(h(null,[p[m],p[m+1],p[m+2]]).position))}else if(2===t.translationKeylist.compression){var f=t.translationKeylist.block.map((function(t){return _e(t)})),y=f[0];l=we(f[1],y,(f.length-2)/3);for(var g=f.slice(2),b=0;b<g.length;b+=3)c.push.apply(c,Object(w.a)(h(null,[g[b],g[b+1],g[b+2]]).position))}else console.error(t.translationKeylist.compression," compression bestaat nog niet");l.length>0&&c.length>0&&a.push(new M.e.VectorKeyframeTrack(s+".position",l,c)),r=Math.max.apply(Math,[r].concat(Object(w.a)(l)))}if(t.hasRotationKeylist){var v=t.rotationKeylist.block,_=[],k=[];if(2===t.rotationKeylist.compression){var x=v[0];_=we(v[1],x,(v.length-2)/4);for(var j=2;j<v.length;j+=4){var S=[v[j],v[j+1],v[j+2],v[j+3]];k.push.apply(k,Object(w.a)(h(S).quaternion))}}else if(3===t.rotationKeylist.compression){var O=v[0];_=we(v[1],O,v.length-5);var A=v.slice(2,5).map((function(t){return Math.round(t)})),T=Object(u.a)(A,3),L=T[0],P=T[1],I=T[2];v.slice(5).forEach((function(t){var e=new M.e.Quaternion;e.setFromAxisAngle(new M.e.Vector3(L,P,I),t);var i=h([e.w,e.x,e.y,e.z]).quaternion;k.push.apply(k,Object(w.a)(i))}))}else if(1===t.rotationKeylist.compression){_=v.slice(0,v.length/2-1).map((function(t){return 1*t}));var E=v.slice(_.length,_.length+3).map((function(t){return Math.round(t)})),C=Object(u.a)(E,3),R=C[0],F=C[1],D=C[2];v.slice(_.length+3).forEach((function(t){var e=new M.e.Quaternion;e.setFromAxisAngle(new M.e.Vector3(R,F,D),t);var i=h([e.w,e.x,e.y,e.z]).quaternion;k.push.apply(k,Object(w.a)(i))}))}else if(0===t.rotationKeylist.compression){_=v.slice(0,v.length/5).map((function(t){return 1*t}));for(var N=v.slice(v.length/5),B=0;B<N.length;B+=4){var z=[N[B],N[B+1],N[B+2],N[B+3]];k.push.apply(k,Object(w.a)(h(z).quaternion))}}else console.error(t.rotationKeylist.compression," compression bestaat nog niet!");if(_.length>0&&k.length>0){var G=new M.e.QuaternionKeyframeTrack(s+".quaternion",_,k);G.compression=t.rotationKeylist.compression,a.push(G)}r=Math.max.apply(Math,[r].concat(Object(w.a)(_)))}}}));var s=new M.e.AnimationClip(n,_e(r),a);p.push({name:n,clip:s})}))}var at=Object(ve.a)(s);return at.computeVertexNormals(),X.geometry=at,X.rotateX(-Math.PI/2),X.scale.setScalar(.01),X.animations={},p.forEach((function(t){var e=t.name,i=t.clip;X.animations[e]={clip:i,action:nt.clipAction(i)}})),X.castShadow=!0,X.receiveShadow=!1,X.isAlphaMap=n,{mesh:X,boneNames:K,motions:p,mixer:nt,shootable:i}},Oe=i(138),Ae=i(137),Te=["GrobberBrok.act","bat.act","batfly.act","batG.act","batlamp.act","batR.act","batY.act","book.act","brcrate.act","brcrate_s1.act","brcrate_s2.act","brok1.act","brok2.act","brok3.act","Brutus.act","brutusb.act","brutusm.act","cannball_rol.act","Canon.act","canonball.act","chair_red.act","coff01top.act","coffin01.act","coffin02.act","coffin1.act","coffin2.act","cross.act","cross1.act","cross2.act","cross3.act","cross4.act","cross5.act","cross6.act","cross7.act","cross8.act","fep_test5.act","fleuribloem.act","folter.act","frog.act","gargoyle.act","ggb.act","ggh.act","ggll.act","gglw.act","ggrl.act","ggrw.act","GhostG.act","GhostR.act","GhostY.act","glashard.act","glaslood.act","glaslood1.act","grafdek.act","grafdum.act","graveskl.act","guardian.act","hangweb.act","hartcontainer.act","heart.act","hekdoor.act","hekdoor_s1.act","hoekweb.act","htorch.act","ICoinL.act","ICoinM.act","IcoinS.act","IHart.act","IHealthL.act","IHealthM.act","IHealthS.act","ILife.act","IMirror.act","ImoneyL.act","ImoneyM.act","ImoneyS.act","Ipotion.act","kandela.act","kandela2.act","kanon.act","knax.act","knbrst.act","knhd.act","knhip.act","knight.act","knight1.act","knight2.act","knight3.act","knllg.act","knlns.act","knlrm.act","knrlg.act","knrrm.act","krnlchtr.act","k_active.act","lampion.act","lans.act","lantern.act","maxd.act","maxj.act","maxtest1.act","mirror.act","mirror_stndrd.act","mxcrate.act","mxmach.act","obelisk.act","pado1.act","pado2.act","pado3.act","paintbr.act","paintmx.act","paintrc.act","paintsl.act","paintwk.act","pbench.act","pillar.act","plankdum.act","plank_s.act","plant.act","rballoon.act","rccrate.act","rccrate_s1.act","rccrate_s2.act","RedCat.act","Redcat2.act","respawn.act","roadsg_l.act","roadsg_r.act","rock.act","rol_rots.act","root.act","rotsexp1.act","r_part01.act","r_part02.act","savepilar.act","savepilarfloor.act","skeleton.act","spade.act","Spider.act","SpiderG.act","SpiderR.act","spiderweb.act","SpiderY.act","standaard.act","statue.act","stnwitch.act","struik1.act","sword.act","sword2.act","teleporter.act","throne.act","torch.act","trchstl.act","tree.act","tree2.act","tstwitch.act","turbot.act","turtop.act","twig.act","ufo.act","whizztest8.act","witch.act","wkcrate.act","wkcrate_s1.act","wkcrate_s2.act","wkkooi.act","zombie.act"];var Le=i(48),Pe=i.n(Le),Me=i(10),Ie=i(28),Ee=new Map;function Ce(t){return Re.apply(this,arguments)}function Re(){return(Re=Object(Ie.a)(Object(Me.a)().mark((function t(e){var i,n;return Object(Me.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Ee.has(e)){t.next=2;break}return t.abrupt("return",Ee.get(e));case 2:return t.next=4,fetch("actors/redcat/".concat(e));case 4:return i=t.sent,t.next=7,i.arrayBuffer();case 7:return n=t.sent,Ee.set(e,n),t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Fe=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;Object(k.a)(this,t),this.origin=e||new M.e.Vector3(0,0,0),this.size=n;var a=(new M.e.TextureLoader).load("textures/smoke.png");this.animators=[],this.group=new M.e.Group,this.group.position.set(this.origin.x,this.origin.y,this.origin.z);for(var o=function(){var t=new M.e.SpriteMaterial({color:16777215,alphaMap:a.clone(),transparent:!0}),e=new M.e.Sprite(t);e.scale.set(40,40,1);var n=Math.random();e.position.set(0,100*n,0),i.group.add(e);var o=new K(t.alphaMap,8,5,40,80,(function(){return e.position.y=0}));o.currentTile=Math.round(o.numberOfTiles*n),i.animators.push(o)},r=0;r<n;r++)o()}return Object(x.a)(t,[{key:"update",value:function(t){this.group.children.forEach((function(e){return e.translateY(20*t)})),this.animators.forEach((function(e){return e.update(1e3*t)}))}}]),t}(),De=i(39),Ne={DYNAMIC:0,STATIC:1,KINEMATIC:2,GHOST:4},Be=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(t,n){var a,o,r=n.spawnPosition,s=n.spawnRotation,h=n.scale,c=n.isShootAble,l=n.canShoot,d=n.canWalkAround,u=n.stillUntilNotice,p=n.subType;return Object(k.a)(this,i),(o=e.call(this,t)).subType=null!==(a=Number(p))&&void 0!==a?a:0,o.hp=100,o.initialized=!1,o.spawnPosition=r,o.spawnRotation=s,o.scene=t.scene,o.physics=t.physics,o.canShoot=l,o.scale=h||.1,o.actorManager=W.getInstance(),o.isShootAble=c,o.dead=!1,o.player=t.player,o.canWalkAround=d,o.stillUntilNotice=u,o.idleMotion="idle",o.deathMotion="death",o.mitMotion="hit",o.shootMotion="shoot1",o.walkMotion="walkfw",o.listener=new M.e.AudioListener,o.sound=new M.e.PositionalAudio(o.listener),o.audioLoader=new M.e.AudioLoader,t.camera.add(o.listener),o.raycaster=new M.e.Raycaster,o.raycaster.camera=t.camera,o.meshWorldPosition=new M.e.Vector3,o.playerWorldPosition=new M.e.Vector3,o.colliderOffsetHeight=0,o.distanceToPlayer=1/0,o.distanceToNoticePlayer=1/0,o.playerNoticed=!1,o.randomAnimationOffset=Math.random(),o.timePassed=0,o.shootTimePassed=0,o.smoke=[],o}return Object(x.a)(i,[{key:"setMotion",value:function(t){var e,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this.mixer.stopAllAction(),null===(e=this.wireFrameMixer)||void 0===e||e.stopAllAction());i&&(this.currentMotion=t);var a=this.mesh.animations[t];if(a)return a.action.time=0,a.action.enabled=!0,a.action.loop=i?M.e.Loop:M.e.LoopOnce,a.action.clampWhenFinished=n,a.action.fadeIn(.25),a.action.play(),a;console.log(t+" motion not found")}},{key:"checkShoot",value:function(){var t=this;if(!this.isShooting&&!this.dead&&this.canSeePlayer&&(this.canShoot||!(this.distanceToPlayer>4.7))){this.isShooting=!0;var e=this.mesh.animations[this.shootMotion];this.setMotion(this.shootMotion,!1,!0,!1),this.canShoot?setTimeout((function(){t.mesh.visible&&t.spawnFireBall()}),300):setTimeout((function(){!t.canShoot&&t.distanceToPlayer<=4.7&&t.player.takeHit()}),.5*e.clip.duration*1e3);setTimeout((function(){e.action.fadeOut(.25),t.isShooting=!1}),1e3*(e.clip.duration-.25))}}},{key:"playSound",value:function(t){var e=this;this.audioLoader.load("sounds/"+t,(function(t){e.sound.stop(),e.sound.setBuffer(t),e.sound.setRefDistance(4),e.sound.play()}))}},{key:"takeHit",value:function(){this.dead||(this.setMotion(this.mitMotion,!1,!0),this.hp=Math.max(0,this.hp-10),0===this.hp&&this.die())}},{key:"checkCanSeePlayer",value:function(){var t=this,e=new M.e.Vector3;if(this.mesh.getWorldPosition(this.meshWorldPosition),this.player.getWorldPosition(this.playerWorldPosition),this.meshWorldPosition.y=this.playerWorldPosition.y=0,this.distanceToPlayer=this.meshWorldPosition.distanceTo(this.playerWorldPosition),!this.canShoot)return this.distanceToPlayer<=this.distanceToNoticePlayer;if(this.distanceToPlayer>this.distanceToNoticePlayer)return!1;e.subVectors(this.playerWorldPosition,this.meshWorldPosition).normalize(),this.raycaster.set(this.meshWorldPosition,e),this.raycaster.far=this.distanceToPlayer;var i=this.scene.children.filter((function(e){return e.visible&&!e.isItem&&e!==t.mesh.parent&&!e.name.includes("act")})),n=this.raycaster.intersectObjects(i,!1);return 0===n.length||!(n[0].object!==this.player&&!this.player.children.includes(n[0].object))}},{key:"die",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){var e,i,n,a,o,r,s,h,c=this;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.dead){t.next=39;break}if(this.spawnSmoke(),this.mixer.stopAllAction(),this.dead=!0,this.mesh.dead=!0,this.object3d.body.setCollisionFlags(Ne.GHOST),this.object3d.body.needUpdate=!0,this.deathParts){t.next=11;break}this.setMotion(this.deathMotion,!1,!0,!0),t.next=39;break;case 11:(e=this.mesh.parent).remove(this.mesh),i=0,n=Object(P.a)(this.deathParts),t.prev=15,n.s();case 17:if((a=n.n()).done){t.next=31;break}return o=a.value,t.next=21,Ce(o);case 21:r=t.sent,s=Se(r,o),(h=s.mesh).position.set(0,1,0),e.add(h),h.scale.setScalar(this.scale),h.position.set(5*i,10*i-20,5*i),i++,this.physics.add.existing(h,{shape:"mesh",mass:1});case 29:t.next=17;break;case 31:t.next=36;break;case 33:t.prev=33,t.t0=t.catch(15),n.e(t.t0);case 36:return t.prev=36,n.f(),t.finish(36);case 39:setTimeout((function(){c.scene.remove(c.object3d),c.actorManager.remove(c.mesh)}),5e3);case 40:case"end":return t.stop()}}),t,this,[[15,33,36,39]])})));return function(){return t.apply(this,arguments)}}()},{key:"spawnSmoke",value:function(){var t=(new M.e.TextureLoader).load("img/smoke.png"),e=new M.e.SpriteMaterial({color:7931079,alphaMap:t,map:t,transparent:!0,opacity:0}),i=new M.e.Sprite(e),n=50+20*Math.random();i.scale.set(n,n,1);for(var a=0;a<3;a++)this.mesh.parent.add(i),this.smoke.push(i),i.fadeIn=!0,i.position.y+=30*(Math.random()-.5),i.position.x+=20*(Math.random()-.5),i.position.z+=20*(Math.random()-.5),i.speed=2+15*Math.random(),i=i.clone()}},{key:"update",value:function(t){if(this.timePassed+=t,this.shootTimePassed+=t,!(this.timePassed<1/30)){this.shootTimePassed>3+this.randomAnimationOffset&&(this.shootTimePassed=0,this.checkShoot()),this.timePassed=0,Object(S.a)(Object(O.a)(i.prototype),"update",this).call(this,t);var e,n=[],a=Object(P.a)(this.smoke);try{for(a.s();!(e=a.n()).done;){var o=e.value;o.fadeIn?(o.material.opacity=Math.min(1,o.material.opacity+.8*t),o.material.opacity>=1&&(o.fadeIn=!1)):o.material.opacity-=.5*t,o.position.y+=t*o.speed,o.position.z+=t*o.speed,o.material.opacity<=0&&n.push(o)}}catch(w){a.e(w)}finally{a.f()}for(var r=0,s=n;r<s.length;r++){var h=s[r];this.smoke.splice(this.smoke.indexOf(h),1),h.parent.remove(h),h.visible=!1}if(this.canSeePlayer=this.checkCanSeePlayer(),this.canSeePlayer&&(this.playerNoticed=!0),!this.canShoot&&this.distanceToPlayer<=4.7&&this.checkShoot(),!this.dead&&this.canSeePlayer&&this.playerNoticed){this.mesh.getWorldPosition(this.meshWorldPosition),this.player.getWorldPosition(this.playerWorldPosition),this.meshWorldPosition.y=this.playerWorldPosition.y=0;var c=this.meshWorldPosition.x-this.playerWorldPosition.x,l=this.meshWorldPosition.z-this.playerWorldPosition.z,d=Math.atan2(c,l),u=new M.e.Vector3,p=this.object3d.getWorldDirection(u);p.multiplyScalar(-1);var m=Math.atan2(p.x,p.z);p.multiplyScalar(-1);var f=Math.atan2(p.x,p.z);this.object3d.body.setAngularVelocityY(0);var y=6*Math.sin(f),g=6*Math.cos(f),b=Math.abs(d-m),v=2,_=Math.PI/24;b>_?(b>Math.PI-_&&(v*=-2),d<m&&(v*=-2),this.rotating=Math.min((this.rotating||0)+t,1),this.object3d.body.setAngularVelocityY(this.rotating*v)):this.rotating=0,this.object3d.rotation.y=d+Math.PI/2,this.canWalkAround&&(this.idleAction&&(this.idleAction.enabled=!1,this.idleAction=null,this.setMotion(this.walkMotion)),this.currentMotion!==this.walkMotion&&this.setMotion(this.walkMotion),this.object3d.body.setVelocity(y,0,g)),this.object3d.body.needUpdate=!0}else this.object3d.body&&(this.object3d.body.setAngularVelocityY(0),this.object3d.body.setVelocity(0,0,0)),this.dead||this.canSeePlayer||this.currentMotion===this.idleMotion||this.stillUntilNotice&&!this.playerNoticed||this.setMotion(this.idleMotion);!this.canWalkAround&&this.object3d.body&&(!this.canSeePlayer||this.currentMotion===this.idleMotion||this.stillUntilNotice&&!this.playerNoticed||this.setMotion(this.idleMotion),this.object3d.body.setVelocity(0,0,0))}}},{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e){var i,n,a,o,r,s,h,c,l,d,u,p,m,f,y,g=this;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ce(e);case 2:n=t.sent,a=Se(n,e,this.isShootAble),o=a.mesh,r=a.mixer,s=a.motions,h=a.shootable,this.mixer=r,this.motions=s,this.mesh=o,o.scale.setScalar(this.scale),this.mesh.name=e,(c=new M.e.Group).add(o),c.add(this.sound),c.isNpc=!0,l=(new M.e.Box3).setFromObject(o),d=l.getSize(new M.e.Vector3),u=d.y,p=d.x,m=d.z,f=new M.e.BoxGeometry(p,u,m),(y=new M.e.Mesh(f)).visible=!1,y.isCollider=!0,y.takeHit=function(){return g.takeHit()},c.add(y),this.boxMesh=y,this.spawnPosition&&c.position.set(this.spawnPosition.x,this.spawnPosition.y+u/2,this.spawnPosition.z),this.spawnRotation&&c.rotation.set(this.spawnRotation.x,this.spawnRotation.y,this.spawnRotation.z),o.position.set(0,-u/2,0),(null!==(i=this.parent)&&void 0!==i?i:this.scene).add(c),this.physics.add.existing(c,{mass:1e4,shape:"box",width:p,height:u,depth:m}),c.body.setCollisionFlags(Ne.DYNAMIC),c.body.setFriction(1),c.body.setAngularFactor(0,0,0),this._target=c,this.object3d=c,this.initialized=!0,this.isShootAble&&(o.takeHit=function(){return g.takeHit()}),this.actorManager.add({mesh:o,motions:s,mixer:r,shootable:h,update:this.update.bind(this)}),this.stillUntilNotice||(this.idleAction=this.setMotion(this.idleMotion));case 39:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),i}(X),ze=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(t,n){var a;return Object(k.a)(this,i),(a=e.call(this,t,Object(De.a)(Object(De.a)({},n),{},{isShootAble:!0,canShoot:!0,canWalkAround:!1,scale:1.65}))).distanceToNoticePlayer=60,a}return Object(x.a)(i,[{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(S.a)(Object(O.a)(i.prototype),"init",this).call(this,"brutusm.act");case 2:this._target.name="brutus";case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"die",value:function(){this.dead||(Object(S.a)(Object(O.a)(i.prototype),"die",this).call(this),Object(S.a)(Object(O.a)(i.prototype),"playSound",this).call(this,"Brlvl5.wav"))}},{key:"takeHit",value:function(){this.dead||(Object(S.a)(Object(O.a)(i.prototype),"takeHit",this).call(this),Object(S.a)(Object(O.a)(i.prototype),"playSound",this).call(this,"Brlvl2.wav"))}}]),i}(Be),Ge=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(t,n){var a;return Object(k.a)(this,i),(a=e.call(this,t,Object(De.a)(Object(De.a)({},n),{},{isShootAble:!0,canShoot:!0,canWalkAround:!0}))).distanceToNoticePlayer=30,a.hp=10,a}return Object(x.a)(i,[{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(S.a)(Object(O.a)(i.prototype),"init",this).call(this,"frog.act");case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"die",value:function(){this.dead||Object(S.a)(Object(O.a)(i.prototype),"die",this).call(this)}},{key:"takeHit",value:function(){this.dead||Object(S.a)(Object(O.a)(i.prototype),"takeHit",this).call(this)}}]),i}(Be),Ue=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(t,n){var a;return Object(k.a)(this,i),(a=e.call(this,t,Object(De.a)(Object(De.a)({},n),{},{isShootAble:!0,canShoot:!1,canWalkAround:!1,scale:1.9,stillUntilNotice:!0}))).distanceToNoticePlayer=10,a.hp=10,a.deathParts=["knllg.act","knlns.act","knlrm.act","knrrm.act","knrlg.act","knhip.act","knhd.act"],a}return Object(x.a)(i,[{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(S.a)(Object(O.a)(i.prototype),"init",this).call(this,"knight.act");case 2:this._target.name="knight";case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"die",value:function(){this.dead||Object(S.a)(Object(O.a)(i.prototype),"die",this).call(this)}},{key:"takeHit",value:function(){this.dead||Object(S.a)(Object(O.a)(i.prototype),"takeHit",this).call(this)}}]),i}(Be),We=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(t,n){var a;return Object(k.a)(this,i),(a=e.call(this,t,Object(De.a)(Object(De.a)({},n),{},{isShootAble:!0,canShoot:!0,canWalkAround:!1,scale:1.7}))).idleMotion="idle0",a.colliderOffsetHeight=-1,a.distanceToNoticePlayer=50,a.hp=50,a}return Object(x.a)(i,[{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(S.a)(Object(O.a)(i.prototype),"init",this).call(this,"plant.act");case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"die",value:function(){this.dead||Object(S.a)(Object(O.a)(i.prototype),"die",this).call(this)}},{key:"takeHit",value:function(){this.dead||Object(S.a)(Object(O.a)(i.prototype),"takeHit",this).call(this)}}]),i}(Be),He=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(t,n){var a;return Object(k.a)(this,i),(a=e.call(this,t,Object(De.a)(Object(De.a)({},n),{},{isShootAble:!0,canShoot:!0,canWalkAround:!0}))).distanceToNoticePlayer=30,a.hp=10,a}return Object(x.a)(i,[{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){var e;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=["Spider.act","SpiderG.act","SpiderY.act"])[this.subType]||console.log("For spider subtype: "+this.subType+" not found"),t.next=4,Object(S.a)(Object(O.a)(i.prototype),"init",this).call(this,e[this.subType]);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"die",value:function(){this.dead||Object(S.a)(Object(O.a)(i.prototype),"die",this).call(this)}},{key:"takeHit",value:function(){this.dead||Object(S.a)(Object(O.a)(i.prototype),"takeHit",this).call(this)}}]),i}(Be),Ve={1:We,2:Ue},Ke={1:He,5:Ge,7:ze};function Xe(t){var e={};e.__proto__=t.prototype;for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var o=t.call.apply(t,[e].concat(n));return"undefined"!==typeof o?o:e}var Ye={ItemPotion:{ActorfileName:"Ipotion.act",Scale:2,IsItem:!0},ItemHealth:{ActorfileName:"IHealthL.act",Scale:3,IsItem:!0},ItemCoin:{ActorfileName:"ImoneyM.act",Scale:2,IsItem:!0}},Je={"levels/lvl00a.bsp":{},"levels/lvl01a.bsp":{"map-object-0":[0,0,0]},"levels/lvl02a.bsp":{"map-object-0":[0,0,0]}},qe={"levels/lvl01a.bsp":{"map-object-0":[764,726,773,1550,797,1617,1619,1535,1644,1530,1636,1630,1533,1545]}},Qe=new M.e.MeshLambertMaterial({transparent:!1,colorWrite:!1,side:M.e.DoubleSide});Qe.name="skybox_material";var Ze=Qe,$e=Object.keys(G),ti=0,ei=!1,ii=function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e,i,n,a,o,r){var s,h,c,l,d,u,p,m,f,y,g,b,v,_,k,x,j,S,O,A,T,L,I,E,C,R,F,D,N,B=arguments;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_=function(t,e){for(var i=[],a=[],o=[],r=-1,s=[],h={start:-1,end:-1,materialIndex:-1},c=new M.e.Vector3,m=[],f=t.faceStart;f<t.faceStart+t.faceCount;f++)m.push(f);m.sort((function(t,e){return d[t].texInfo-d[e].texInfo}));for(var _=function(){var t=k[w],m=d[t],f=y[m.texInfo],_=0!==(4&f.flags);if(_&&!0,_&&n)return"continue";if(r!==f.texture){-1===h.start?h.start=0:(h.end=a.length/3,s.push(h),h={start:h.end,end:-1,materialIndex:-1});var x=l(f.texture,g,b,v,i.length,e),j=i.find((function(t){return t.map===x.map}));j?h.materialIndex=i.indexOf(j):(h.materialIndex=i.length,i.push(x)),r=f.texture,_&&(-1===i.indexOf(Qe)&&i.push(Qe),h.materialIndex=i.indexOf(Qe),r="skybox")}for(var S=qe[window.level]&&qe[window.level][e]&&qe[window.level][e].includes(h.materialIndex),O=[],A=Number.MAX_VALUE,T=Number.MAX_VALUE,L=0;L<m.vertCount-2;L++){var P=u[p[m.vertStart]];S&&((P=new M.e.Vector3).x=0,P.y=0,P.z=0),c.copy(P);var I=c.dot(f.vecs[0]),E=c.dot(f.vecs[1]);I<A&&(A=I),E<T&&(A=I),a.push(P.x,P.y,P.z),O.push(I,E),P=u[p[m.vertStart+L+1]],S&&((P=new M.e.Vector3).x=0,P.y=0,P.z=0),c.copy(P),(I=c.dot(f.vecs[0]))<A&&(A=I),(E=c.dot(f.vecs[1]))<T&&(A=I),a.push(P.x,P.y,P.z),O.push(I,E),P=u[p[m.vertStart+L+2]],S&&((P=new M.e.Vector3).x=0,P.y=0,P.z=0),c.copy(P),(I=c.dot(f.vecs[0]))<A&&(A=I),(E=c.dot(f.vecs[1]))<T&&(A=I),a.push(P.x,P.y,P.z),O.push(I,E)}for(var C=1/f.drawScale[0],R=1/f.drawScale[1],F=g[f.texture],D=F.width,N=F.height,B=f.shift[0],z=f.shift[1],G=0;G<O.length;G+=2){var U=O[G+0],W=O[G+1];o.push((U*C+B)/D,(W*R+z)/N)}},w=0,k=m;w<k.length;w++)_();h.end=a.length/3,s.push(h);var x=new M.e.BufferGeometry;x.setAttribute("position",new M.e.Float32BufferAttribute(a,3)),x.setAttribute("uv",new M.e.Float32BufferAttribute(o,2)),x.computeVertexNormals(),s.forEach((function(t){var e=t.start,i=t.end,n=t.materialIndex;return x.addGroup(e,i-e,n)})),x=ve.a(x),ti+=x.attributes.position.count;var j=new M.e.Mesh(x,i);return j.name=e,j},l=function(t,e,i,n,a,o){if(void 0!==h[t])return h[t];for(var r=e[t],s=n[r.paletteIndex],c=r.offset,l=new Uint8Array(r.width*r.height*4),d=!1,u=0;u<r.height;u++)for(var p=0;p<r.width;p++){var m=4*(r.width*u+p),f=i[c++];l[m+0]=s[3*f+0],l[m+1]=s[3*f+1],l[m+2]=s[3*f+2],l[m+3]=255;var y=Je[window.level]&&Je[window.level][o];y&&l[m+0]===y[0]&&l[m+1]===y[1]&&l[m+2]===y[2]&&(l[m+3]=0,d=!0)}var g=new M.e.DataTexture(l,r.width,r.height,M.e.RGBAFormat,M.e.UnsignedByteType,M.e.UVMapping,M.e.RepeatWrapping,M.e.RepeatWrapping);return g.needsUpdate=!0,h[t]=new M.e.MeshLambertMaterial({map:g,side:M.e.DoubleSide,transparent:d})},s=B.length>6&&void 0!==B[6]&&B[6],h={},c=W.getInstance(),s){t.next=10;break}new Pe.a(new be.KaitaiStream(i)).chunks.forEach((function(t){switch(t.type){case Pe.a.ChunkType.ENTDATA:f=t.entityList.entities;break;case Pe.a.ChunkType.PALETTES:v=t.elements;break;case Pe.a.ChunkType.TEXINFOS:y=t.elements;break;case Pe.a.ChunkType.TEXTURES:g=t.elements;break;case Pe.a.ChunkType.TEXDATA:b=t.data;break;case Pe.a.ChunkType.MODELS:m=t.elements;break;case Pe.a.ChunkType.FACES:d=t.elements;break;case Pe.a.ChunkType.VERTS:u=t.elements;break;case Pe.a.ChunkType.VERT_INDEX:p=t.elements;break;default:return}})),t.next=17;break;case 10:return m=[],t.next=13,fetch("/level_json/".concat(window.levelIndex,"_entities.json"));case 13:return t.next=15,t.sent.json();case 15:k=t.sent,f=k;case 17:if(x=a.loadingProgress,j=f.length+m.length,S=0,a.loadingMessage&&a.loadingMessage("Loading world models.."),x&&a.loadingProgress(S,j),O=(null===r||void 0===r?void 0:r.disposables)||[],s?A=r.world:(A=new M.e.Group,m.forEach((function(t,e){var i=_(t,"map-object-"+e);i.castShadow=!0,i.receiveShadow=!1,A.add(i),x&&a.loadingProgress(++S,j)}))),s){t.next=28;break}T=f.map((function(t){var e,i,n=new Map;return t.pairs.forEach((function(t){switch(t.key){case"classname":e=t.value;break;case"%name%":i=t.value;break;default:n.set(t.key,t.value)}})),{name:i,classname:e,properties:n}})),t.next=45;break;case 28:T=f,L=Object(P.a)(T),t.prev=30,E=Object(ce.a)().mark((function t(){var e;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=I.value).properties.get=function(t){return e.properties[t]},e.properties.has=function(t){return e.properties[t]};case 3:case"end":return t.stop()}}),t)})),L.s();case 33:if((I=L.n()).done){t.next=37;break}return t.delegateYield(E(),"t0",35);case 35:t.next=33;break;case 37:t.next=42;break;case 39:t.prev=39,t.t1=t.catch(30),L.e(t.t1);case 42:return t.prev=42,L.f(),t.finish(42);case 45:C=[],R=Object(P.a)(T),t.prev=47,D=Object(ce.a)().mark((function t(){var i,n,r,h,l,d,u,p,m,f,y,g,b,v,_,k,T,L,P,I,E,R,D,N,B,z,G,W,H,V,K,X,Y,J,q,Q,Z;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("%Model%"!==(i=F.value).classname){t.next=21;break}if(n=i.properties.get("origin").split(" ").map((function(t){return parseFloat(t)})),!i.properties.has("Model")){t.next=19;break}if(r=parseInt(i.properties.get("Model")),h=s?A.children.find((function(t){return t.name===i.name})):A.children[r]){t.next=9;break}return console.log(i.name+" not found"),t.abrupt("return","continue");case 9:h.name=i.name,"ophaalbrug01"===h.name&&(h.rotation.set(-Math.PI/3,0,0),h.isKinematic=!0),"fence"===h.name&&(h.isKinematic=!0),Object.keys(U).includes(h.name)&&(h.isKinematic=!0),h.isKinematic=!0,l=!1,$e.includes(h.name)&&(l=!0),h.name.includes("teleport")&&(window.teleporters=window.teleporters||[],window.teleporters.push(h)),s||(h.position.fromArray(n),h.geometry.translate(-n[0],-n[1],-n[2])),ei||c.add({mesh:h,shootable:l});case 19:t.next=72;break;case 21:if(!i.classname||!i.classname.includes("AdamAnyActor")&&!Ye[i.classname]||ei){t.next=54;break}return d=Ye[i.classname],u=(null===d||void 0===d?void 0:d.ActorfileName)||i.properties.get("ActorFileName"),p=null===d||void 0===d?void 0:d.IsItem,t.next=27,Ce(u);case 27:m=t.sent,f=Se(m,u),y=f.mesh,g=f.motions,b=f.mixer,v=f.shootable,_=i.properties.get("Origin").split(" ").map((function(t){return Number(t)})),u.includes("savepilarfloor.act")&&(_[1]-=3),y.position.set(_[0],_[1],_[2]),y.rotation.set(-Math.PI/2,0,0),i.properties.get("RotateX")&&y.rotateOnAxis(new M.e.Vector3(1,0,0),ni(Number(i.properties.get("RotateX")))),i.properties.get("RotateZ")&&y.rotateOnAxis(new M.e.Vector3(0,1,0),ni(Number(i.properties.get("RotateZ")))),i.properties.get("RotateY")&&y.rotateOnAxis(new M.e.Vector3(0,0,1),ni(Number(i.properties.get("RotateY")))),(k=(null===d||void 0===d?void 0:d.Scale)||i.properties.get("Scale"))&&y.scale.setScalar(Number(k)),T=i.properties.get("MotionName"),y.scale.x<0&&y.scale.setScalar(1),P=[[0,0,95],null,null,[0,-10,20],null,[0,-3,14]],(L=["kandela.act","lampion.act","trchstl.act","htorch.act","lantern.act","torch.act"]).indexOf(u)>-1&&(E=o.createLightPlaceHolder(14463317,2,20),y.add(E),R=P[L.indexOf(u)]||[0,0,60],(I=E.position).set.apply(I,Object(w.a)(R))),D=null,T&&(D=y.animations[T]),"ufo.act"===u&&(N=new M.e.AudioListener,B=new M.e.PositionalAudio(N),a.camera.add(N),y.add(B),O.push((function(){return B.stop()})),y.rotateOnAxis(new M.e.Vector3(0,1,0),2*Math.PI),z=new M.e.Vector3,y.getWorldPosition(z),z.y+=70,z.x-=40,z.z+=80,G=new Fe(z),z.x+=80,W=new Fe(z),C.push((function(t){return G.update(t)})),C.push((function(t){return W.update(t)})),A.add(G.group),A.add(W.group),(new M.e.AudioLoader).load("sounds/LV1snd1.WAV",(function(t){B.setBuffer(t),B.setLoop(!0),B.setRefDistance(4),B.setVolume(.15),B.play()}))),y.name=u,y.castShadow=!0,y.receiveShadow=!1,y.isItem=p,A.add(y),c.add({mesh:y,motions:g,mixer:b,shootable:v,startMotion:D}),t.next=72;break;case 54:if("StandingEnemy"!==i.classname&&"MovingEnemy"!==i.classname){t.next=72;break}if(H=i.properties.get("Type"),V=i.properties.get("SubType"),K="MovingEnemy"===i.classname?Ke:Ve,X=K[H]){t.next=62;break}return console.log("".concat(i.classname," not found: ")+i.properties.get("DaviName")+" type: ".concat(H," subtype: ").concat(V),i),t.abrupt("return","continue");case 62:Y=new M.e.Vector3,J=i.properties.get("Origin").split(" ").map((function(t){return Number(t)})),Y.set(J[0],J[1],J[2]),q=1.7*Math.abs(Number(i.properties.get("Scale"))),Q=Number(i.properties.get("StartOrientation"))/12*-Math.PI*2,(Z=Xe(X,e,{subType:V,spawnPosition:Y,scale:q,spawnRotation:new M.e.Vector3(0,Q-Math.PI,0)})).parent=A,Z.init(),t.next=72;break;case 72:x&&a.loadingProgress(++S,j);case 73:case"end":return t.stop()}}),t)})),R.s();case 50:if((F=R.n()).done){t.next=57;break}return t.delegateYield(D(),"t2",52);case 52:if("continue"!==t.t2){t.next=55;break}return t.abrupt("continue",55);case 55:t.next=50;break;case 57:t.next=62;break;case 59:t.prev=59,t.t3=t.catch(47),R.e(t.t3);case 62:return t.prev=62,R.f(),t.finish(62);case 65:return N={world:A,entities:T,updateLoops:C,disposables:O,totalVerts:ti},c.calculateDistances(),t.abrupt("return",N);case 68:case"end":return t.stop()}}),t,null,[[30,39,42,45],[47,59,62,65]])})));return function(e,i,n,a,o,r){return t.apply(this,arguments)}}();function ni(t){return t*(Math.PI/180)}var ai=i(106),oi=i(105),ri=function(){function t(e,i){Object(k.a)(this,t),this.scene=e,this.target=i,this.lightPlaceholders=[],this.lights=[],this.maxLightSources=dt.Get(lt.MAX_NUMBER_LIGHTS),this.targetPos=new M.e.Vector3,this.lightPos=new M.e.Vector3,this.timePassed=0;for(var n=0;n<this.maxLightSources;n++){var a=new M.e.PointLight(16777215*Math.random(),0,20,2);a.castShadow=!0,a.shadow.autoUpdate=!1,a.shadow.mapSize.x=dt.Get(lt.SHADOW_RESOLUTION),a.shadow.mapSize.y=dt.Get(lt.SHADOW_RESOLUTION),this.lights.push(a),this.target.add(a)}}return Object(x.a)(t,[{key:"update",value:function(t){this.timePassed+=t,this.timePassed>.25&&(this.timePassed=0,this.sortLightsOnDistance());var e=this.lights.slice(0);this.target.getWorldPosition(this.targetPos);var i,n=Object(P.a)(this.lightPlaceholders);try{for(n.s();!(i=n.n()).done;){var a=i.value;if(e.length>0&&a.dis<120){var o,r,s=e.indexOf(a.children[0]);if(a.children[0]&&s>-1){a.skipDelete=!0;var h=e.splice(s,1),c=Object(u.a)(h,1)[0];a.parent===this.target&&(c.shadow.needsUpdate=!0);continue}a.children.length,a.children.length&&console.warn("Dit zou niet moeten kunnen?");var l,d=null,p=-1,m=Object(P.a)(e);try{for(m.s();!(l=m.n()).done;){var f=l.value;if(f.parent===this.target){d=f;break}if(!f.parent.dis){f.getWorldPosition(this.lightPos);var y=this.lightPos.distanceTo(this.targetPos);f.parent.dis=y}f.parent.dis>p&&(p=f.parent.dis,d=f)}}catch(A){m.e(A)}finally{m.f()}e.splice(e.indexOf(d),1),a.children[0],a.add(d),d.shadow.needsUpdate=!0,d.position.set(0,0,0),d.intensity=0,d.distance=null!==(o=a.distance)&&void 0!==o?o:d.distance,d.decay=null!==(r=a.decay)&&void 0!==r?r:d.decay,a.visible=!0}else a.visible=!0}}catch(A){n.e(A)}finally{n.f()}for(var g=!0,b=this.lightPlaceholders.length-1;b>=0;b--){var v=this.lightPlaceholders[b];v.children.length&&(g?(g=!1,v.children[0].intensity-=t,v.children[0].intensity=E(v.children[0].intensity,0,v.flickerIntensity)):(v.children[0].intensity+=t,v.children[0].intensity=E(v.children[0].intensity,0,v.flickerIntensity)))}var _,w=Object(P.a)(e);try{for(w.s();!(_=w.n()).done;){var k=_.value;k.parent!==this.target&&(k.intensity=0,this.target.add(k),k.position.set(0,0,0))}}catch(A){w.e(A)}finally{w.f()}var x,j=Object(P.a)(this.lights);try{for(j.s();!(x=j.n()).done;){var S,O=x.value;null!==(S=O.parent)&&void 0!==S&&S.parent&&!O.parent.parent.visible&&(O.intensity=0,this.target.add(O),O.position.set(0,0,0))}}catch(A){j.e(A)}finally{j.f()}}},{key:"createLightPlaceHolder",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=new M.e.Group;return a.color=t,a.intensity=e,a.distance=i,a.decay=n,a.flickerIntensity=e,this.lightPlaceholders.push(a),a}},{key:"sortLightsOnDistance",value:function(){var t=this;this.target.getWorldPosition(this.targetPos),this.lightPlaceholders.sort((function(e,i){e.getWorldPosition(t.lightPos);var n=t.lightPos.distanceTo(t.targetPos);e.dis=n,i.getWorldPosition(t.lightPos);var a=t.lightPos.distanceTo(t.targetPos);return i.dis=a,e.flickerIntensity=e.intensity+.5*(Math.random()-.5),n-a}))}},{key:"remove",value:function(t){I(this.lightPlaceholders,t)}}]),t}(),si=i(135),hi=i.n(si),ci=function(){function t(e){var i=this;Object(k.a)(this,t);var n=window.mobileCheck(),a=document.createElement("div");a.style.position="fixed",a.style.bottom="0",a.style.left="0",a.style.right="0";var o=document.createElement("div");o.style.textAlign="center",o.style.color="white",o.style.textShadow="1px 1px 3px rgba(0, 0, 0, 0.75)",o.style.fontSize="2vw",o.style.marginBottom="5vh",o.style.marginLeft="8vw",o.style.marginRight="8vw",a.appendChild(o),this.subtitleElement=o;var r=document.createElement("div");r.style.position="fixed",r.style.left="0",r.style.right="0",r.style.height="0",r.style.backgroundColor="black",r.style.transition="height .2s ease-in-out";var s=r.cloneNode();r.style.top="0",s.style.bottom="0",this.cutSceneBarTop=r,this.cutSceneBarBottom=s;var h=document.createElement("span");h.style.position="fixed",h.style.right="12px",h.style.marginTop="12px",n||(h.innerText="Press E to skip"),this.cutSceneBarBottom.appendChild(h),document.body.appendChild(this.cutSceneBarTop),document.body.appendChild(this.cutSceneBarBottom),document.body.appendChild(a),this.audioLoader=new M.e.AudioLoader,this.audioListener=e,this.sound=new M.e.PositionalAudio(e),this.reverb=new F.a.Effects.Reverb({time:1.89,decay:1.32,reverse:!1,mix:3===window.levelIndex?.5:0});try{this.sound.setFilter(this.reverb)}catch(c){console.warn(c)}this.clearSubTimeout=null,this.stop=!1,document.addEventListener("keydown",(function(t){"e"===t.key.toLowerCase()&&i.skipCutScene()}))}return Object(x.a)(t,[{key:"skipCutScene",value:function(){this.stop=!0,this.sound.stop(),this.clearSubtitle()}},{key:"dispose",value:function(){this.skipCutScene()}},{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){var e,i;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"ENG",t.next=3,fetch("language/LanguageENG.ini");case 3:return e=t.sent,t.next=6,e.text();case 6:i=t.sent,this.language=hi.a.parse(i);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"setSubtitle",value:function(t){this.subtitleElement.innerText=t,this.cutSceneBarTop.style.height="15vh",this.cutSceneBarBottom.style.height="15vh"}},{key:"clearSubtitle",value:function(){this.subtitleElement.innerText="",this.cutSceneBarTop.style.height="0",this.cutSceneBarBottom.style.height="0"}},{key:"playSound",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e){var i=this;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.stop){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",new Promise((function(t){i.audioLoader.load("sounds/"+e,(function(t){i.sound.pause(),i.sound.stop(),i.sound.setBuffer(t),i.sound.setLoop(!1),i.sound.setVolume(1),i.sound.setRefDistance(4),i.sound.play()})),i.sound.onEnded=function(){return t()}})));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"playCutScene",value:function(t,e){var i=this;if(!this.stop){var n=t;t.fileName&&(n=t.fileName),n=n.replace(".wav","");var a=this.language["CUT Scene"][n];return a&&this.setSubtitle(a),this.audioLoader.load("voice/"+n+".wav",(function(e){i.sound.pause(),i.sound.stop(),i.sound.setBuffer(e),i.sound.setLoop(!1),i.sound.setVolume(1),i.sound.setRefDistance(4),t.far?i.reverb.mix=.8:i.reverb.mix=3===window.levelIndex?.5:0,i.sound.play()})),this.clearSubTimeout&&clearTimeout(this.clearSubTimeout),this.sound.onEnded=function(){if(i.sound.isPlaying=!1,i.clearSubTimeout=setTimeout((function(){i.clearSubtitle()}),500),e){if(i.stop)return;t.far?setTimeout((function(){e()}),1e3):e()}},this.sound}}}]),t}(),li=function(){function t(e){Object(k.a)(this,t),this.scene=e}return Object(x.a)(t,[{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){var e,i,n,a,o,r;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=new M.e.TextureLoader,i=e.load("img/ufohole.jpeg"),n=e.load("img/ufohole_a.jpeg"),a=new M.e.MeshBasicMaterial({map:i,alphaMap:n,transparent:!0}),o=new M.e.PlaneGeometry(8,8),(r=new M.e.Mesh(o,a)).rotateX(-Math.PI/2),r.position.set(-61,-7.9,112),this.scene.scene.add(r);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),di=function(){function t(){Object(H.a)(this,t),this.url="img/HUDicon.png",this.width=256,this.height=256,this.tilesHorizontal=6,this.tilesVertical=6,this.sourceImage=document.createElement("div"),this.sourceImage.style.backgroundImage="url('"+this.url+"')",this.sourceImage.style.width=this.width/this.tilesHorizontal+"px",this.sourceImage.style.height=this.height/this.tilesVertical+"px",this.sourceImage.className="hud-child";var e=document.createElement("div");e.className="hud",document.body.appendChild(e),this.potion=this.getSubImage(0,5),this.potion.style.right="10%",this.potion.style.top="10%",e.appendChild(this.potion)}return Object(V.a)(t,[{key:"getSubImage",value:function(t,e){var i=this.sourceImage.cloneNode();return t/=this.tilesHorizontal,t*=this.width,e/=this.tilesVertical,e*=this.height,i.style.backgroundPosition="-"+t+"px -"+e+"px",i}},{key:"update",value:function(){}}]),t}(),ui=function(){function t(e,i){Object(k.a)(this,t),this.scene=e.scene,this.player=e.player,this.spawns=[],this.voiceManager=i,this.currentActive=null,this.mesh=new M.e.Group;for(var n=new M.e.TextureLoader,a=0,o=[["fleurl7_A.bmp","fleurl7.bmp",null,.5,.5],["fleurl9_A.bmp","fleurl9.bmp"],["fleuri_A.bmp","fleuri.bmp",.3]];a<o.length;a++){var r=Object(u.a)(o[a],5),s=r[0],h=r[1],c=r[2],l=r[3],d=r[4],p=n.load("textures/fleurifee/"+h),m=n.load("textures/fleurifee/"+s),f=new M.e.SpriteMaterial({map:p,alphaMap:m,transparent:!0,opacity:.8}),y=new M.e.Sprite(f);l&&y.scale.setScalar(l),y.rotationFactor=c,y.rotationSpeed=d,this.mesh.add(y)}var g=e.lightManager.createLightPlaceHolder(14463317,1,10,2);this.mesh.add(g),this.scene.add(this.mesh),this.mesh.visible=!1}return Object(x.a)(t,[{key:"add",value:function(t,e){var i=new M.e.Vector3;t.getWorldPosition(i),this.spawns.push({position:i,script:e,mesh:t})}},{key:"runScript",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){var e,i,n=this,a=arguments;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==(e=a.length>0&&void 0!==a[0]?a[0]:0)){t.next=15;break}return this.voiceManager.stop=!1,console.log("start ",this.currentActive),i=new M.e.Vector3,this.currentActive.mesh.getWorldDirection(i),this.mesh.position.set(this.currentActive.position.x,this.currentActive.position.y,this.currentActive.position.z),this.mesh.rotation.set(this.currentActive.mesh.rotation.x,this.currentActive.mesh.rotation.y,this.currentActive.mesh.rotation.z),this.mesh.translateY(-4),this.mesh.translateZ(4),this.totalTime=0,this.startPosition=this.mesh.position.clone(),this.mesh.add(this.voiceManager.sound),t.next=15,this.voiceManager.playSound("Gri5FX11.WAV");case 15:if(this.currentActive.script[e]){t.next=18;break}return this.end(),t.abrupt("return");case 18:this.currentActive.script[e].startsWith("Rc")?this.player.add(this.voiceManager.sound):this.mesh.add(this.voiceManager.sound),this.voiceManager.playCutScene(this.currentActive.script[e],(function(){setTimeout((function(){n.runScript(e+1)}),500)}));case 20:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"end",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.voiceManager.playSound("magiev12.WAV");case 2:this.currentActive.done=!0,console.log("end ",this.currentActive),this.player.add(this.voiceManager.sound),this.mesh.visible=!1;case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"update",value:function(t){if(this.currentActive&&!this.currentActive.done){this.totalTime+=t;var e=this.startPosition;this.mesh.position.set(e.x+Math.sin(this.totalTime),e.y+Math.cos(this.totalTime),e.z-Math.sin(this.totalTime+2));var i,n=Object(P.a)(this.mesh.children);try{for(n.s();!(i=n.n()).done;){var a=i.value;"Sprite"===a.type&&(a.rotationFactor?a.material.rotation=Math.sin(2*this.totalTime)*a.rotationFactor:a.material.rotation-=t*(a.rotationSpeed||2))}}catch(h){n.e(h)}finally{n.f()}this.mesh.visible=!0}if(!this.currentActive||this.currentActive.done){var o,r=Object(P.a)(this.spawns);try{for(r.s();!(o=r.n()).done;){var s=o.value;if(!s.done&&s.position.distanceTo(this.player.position)<25)return this.currentActive=s,void this.runScript()}}catch(h){r.e(h)}finally{r.f()}}else this.voiceManager.stop&&this.end()}}]),t}(),pi=[[["RcGen46","FLGen3","RcGen47","RcGen48","FLGen4","RcGen49","FLGen5","RcGen50","FLGen6","RcGen51","FLGen7","RcGen52","FLGen8","RcGen53","FLGen9","RcGen54","RcGen56"],["FLGen10"],["FLGen11"],["FLGen12","FLGen13","RcGen57","FLGen14"],["FLGen15","RcGen58","FLGen16","RcGen59","FLGen17"],["FLGen18","RcGen60","FLGen19"],["FLGen21","RcGen61","FLGen22"],["FLGen23","RcGen62"],["FLGen24","RcGen63","FLGen25","RcGen64"]]],mi=i(136);var fi=new(i(68).a);function yi(t){return new Promise((function(e){fi.load(t,(function(t){e(t.scene.children[0])}))}))}var gi=new oi.a;gi.load("json_font/optimer_bold.typeface.json",function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e;case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());var bi=new mi.a,vi=document.createElement("a");function _i(t,e){var i=new Blob([t],{type:"text/plain"}),n=URL.createObjectURL(i);vi.href=n,vi.download=e,vi.click()}vi.style.display="none",document.body.appendChild(vi);var wi="ontouchstart"in window,ki=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),xi=wi&&ki,ji=0,Si=20,Oi=20,Ai=new L.Clock,Ti=new L.Clock,Li=null,Pi=function(t,e){for(var i,n={binary:!0},a=null!==(i=t.material)&&void 0!==i&&i.length?t.material:t.material?[t.material]:[],o=0;o<a.length;o++)a[o].side=L.DoubleSide,a[o].depthWrite=!0,a[o].metalness=0,a[o].roughness=1,a[o].transparent=!1;t.animations&&(n.animations=Object.keys(t.animations).map((function(e){return t.animations[e].clip}))),bi.parse(t,(function(t){console.log(t),_i(t,e.replace(".act",".glb"))}),(function(t){console.log("An error happened")}),n)},Mi=8,Ii=function(t){Object(A.a)(i,t);var e=Object(T.a)(i);function i(){var t,n;Object(k.a)(this,i),(n=e.call(this,"MainScene")).currentActor="RedCat.act",n.showSkeleton=!1,n.showVertexNormalHelper=!1,n.showCollider=!1,n.lt=new Date,n.disposables=[],n.direction=new L.Vector3(0,0,1),n.speed=.1,n.moveTop=0,n.moveRight=0,n.lastControlsUpdate={moveTop:0,moveRight:0},n.mouseSensitivity=1,n.fleurifeeIx=0,n.scale=dt.Get(lt.RESOLUTION_SCALE),window.level=localStorage.getItem("level")||"levels/lvl00a.bsp";var a="1"===localStorage.getItem("mapControls");window.mapControls=a;var o=localStorage.getItem("position"+window.level)&&JSON.parse(localStorage.getItem("position"+window.level));n.playerPositionFromLocalStorage=o,n.currentLevelIndex=[0,1,2,3,4].find((function(t){return Ci(t)===window.level})),window.levelIndex=n.currentLevelIndex,n.playerPosition=(o?[o.x,o.y,o.z]:null===(t=Y[n.currentLevelIndex])||void 0===t?void 0:t.position)||Y[0].position,n.NEAR=1,n.FAR=120-(2===n.currentLevelIndex?50:1===n.currentLevelIndex?-50:0),n.FOG_START=90,n.frames=0,L.AudioContext.setContext(F.a.context),n.audioListener=new L.AudioListener,n.voiceManager=new ci(n.audioListener);var r=[li];return n.targetRadiusSmooth=Mi,r[n.currentLevelIndex]&&(n.levelScript=new r[n.currentLevelIndex](Object(j.a)(n))),n}return Object(x.a)(i,[{key:"init",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.renderer.setPixelRatio(1),this.stats=this.initStats(),window.renderer=this.renderer,this.renderer.debug.checkShaderErrors=!0,dt.Get(lt.SHADOWS_ENABLED)||(this.renderer.shadowMap.enabled=!1),this.renderer.shadowMap.type=L.BasicShadowMap,this.setScale(this.scale),t.next=9,this.voiceManager.init();case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"preload",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"create",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){var e,i,n,a,o,r,s,h,c,l,d,u,p,m,f,y,g,b,v,_,k,x,j,S,O,A,T,I,E,C,R=this;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.warn("CREATiNG SCENE"),t.next=3,this.warpSpeed("-orbitControls","-ground","-sky","-camera");case 3:return a=t.sent,o=a.lights,r=o.hemisphereLight,s=o.ambientLight,h=o.directionalLight,window.scene=this.scene,window.enable3dScene=this,this.hud=new di,this.canvas.id="webgl-canvas",window.addEventListener("resize",(function(t){R.setScale(R.scale)})),this.scene.loadLevel=function(t){localStorage.setItem("level",Ci(t))},this.scene.onTouchUpdate=function(t,e){R.playerController.input.updateMovement(t,e)},this.scene.onInput=function(t){R.playerController.input._keysPressed[t]=!0,requestAnimationFrame((function(){R.playerController.input._keysPressed[t]=!1}))},this.scene.dispose=this.dispose.bind(this),document.documentElement.addEventListener("fullscreenchange",(function(t){document.fullscreenElement?document.body.classList.remove("paused"):document.body.classList.add("paused")})),this.scene.onPointerLock=function(){if(wi){var t;xi||null===(t=window.screen.orientation)||void 0===t||t.lock("landscape"),document.body.classList.remove("paused"),R.playMusic()}else{if(document.pointerLockElement===R.canvas)return void document.body.classList.remove("paused");var e=performance.now();if(null!=Li&&e-Li<2e3)return;R.canvas.requestPointerLock(),Li=e}},this.scene.setScale=function(t){R.setScale(t)},window.level.includes("debug")&&(window.snel=!0,(c=this.physics.factory.add.plane({x:this.playerPosition[0],y:this.playerPosition[1]-10,z:this.playerPosition[2],width:1e3,height:1e3},{lambert:{color:16777215}})).rotation.set(Math.PI/2,0,0),this.physics.add.existing(c,{mass:0,collisionFlags:1}),l=0,(new oi.a).load("json_font/optimer_bold.typeface.json",function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e){var i,n,a,o,r,s,h,c,d,u;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=Object(P.a)(Te),t.prev=1,i.s();case 3:if((n=i.n()).done){t.next=25;break}return a=n.value,o=new ai.a(a,{font:e,size:.75,height:.5}),(r=new L.Mesh(o,new L.MeshPhongMaterial({color:7173071}))).rotateY(-Math.PI/2),r.position.set(0,2,0),s=0,h=R.playerPosition[2]-10,s+=c=25*l,s%=600,d=Math.floor(c/600),h+=25*d,t.next=18,R.loadActor(a,.1,s-300,R.playerPosition[1]+2,h,!0);case 18:return u=t.sent,t.next=21,new Promise((function(t){return setTimeout(t,500)}));case 21:u.add(r),l++;case 23:t.next=3;break;case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(1),i.e(t.t0);case 30:return t.prev=30,i.f(),t.finish(30);case 33:case"end":return t.stop()}}),t,null,[[1,27,30,33]])})));return function(e){return t.apply(this,arguments)}}())),this.scene.camera=this.camera,this.scene.background=new L.Color(10724259),this.scene.fog=new L.Fog(10724259,this.FOG_START-(2===this.currentLevelIndex||1===this.currentLevelIndex?50:0),this.FAR),d=["right.png","left.png","top.png","bottom.png","front.png","back.png"],u=new L.CubeTextureLoader,p=u.load(d.map((function(t){return"skybox/night/"+t}))),this.scene.background=p,r.intensity=.2,s.intensity=.1,h.intensity=0,this.sound=new L.Audio(this.audioListener),window.camera=this.camera,this.camera.position.set(ji,Si,Oi),t.next=34,this.loadActor(this.currentActor,.064,this.playerPosition[0],this.playerPosition[1],this.playerPosition[2],!0,new L.Vector3(-Math.PI/2,0,0));case 34:if(this.player=t.sent,this.player.body.checkCollisions=!0,this.player.isPlayer=!0,this.player.children.forEach((function(t){return t.isPlayer=!0})),this.player.takeHit=function(){return R.player.children[0].takeHit()},this.actorManager=W.getInstance(),this.actorManager.target=this.player,this.actorManager.camera=this.camera,this.actorManager.scene=this.scene,this.actorManager.physics=this.physics,window.actorManager=this.actorManager,this.lightManager=new ri(this.scene,this.player,this.FAR),window.player=this.player,this.player.add(this.voiceManager.sound),this.camera.add(this.audioListener),this.fleurifee=new ui(this,this.voiceManager),m=function(t){var e=t.name.replace(new RegExp("[0-9]","g"),"X");U[t.name]?R.actorManager.collide(t,t.name):U[e]&&R.actorManager.collide(t,e)},this.player.body.on.collision((function(t,e){t.parent&&m(t.parent),m(t),t.isItem&&(t.taken||(t.taken=!0,R.playerController.takeItem(t),t.parent.remove(t),R.physics.destroy(t.body)))})),window.level.includes("debug")){t.next=79;break}return t.next=55,yi("levels/level"+this.currentLevelIndex+".glb");case 55:return y=t.sent,this.worldBsp={world:y,disposables:[]},.05,this.worldBsp.world.scale.setScalar(.05),this.worldBsp.world.isWorld=!0,this.add.existing(this.worldBsp.world),t.next=63,ii(this,null,!1,this.scene,this.lightManager,this.worldBsp,!0);case 63:g=t.sent,g.world,g.entities,b=g.updateLoops,v=g.disposables,this.worldBsp.updateLoops=b,this.worldBsp.disposables=v,(f=this.disposables).push.apply(f,Object(w.a)(v)),this.scene.loadingMessage&&this.scene.loadingMessage("Adding physics..."),_=["trigger","csmc","UFO_souduit","UFO_soundaan","schuinvlaktrap","draai_opening01","savepoint","camera","cambibli","crypt","sluis","trig","exit","kill","secret","hek1","hek2","reset","endlevel","stoneani","doorwallhallway02","doorwallhallway01","text"],k=Object(w.a)(Array(20).keys()),_.push.apply(_,Object(w.a)(k.map((function(t){return"deur"+t})))),!1,x=function t(e){var i;if("text"!==e.name&&!e.isNpc){if("fleuribloem.act"===e.name){var n=pi[R.currentLevelIndex]||[];R.fleurifee.add(e,n[R.fleurifeeIx++]||[])}e.name,e.name.includes("Mesh_0001_24");for(var a=null!==(i=e.material)&&void 0!==i&&i.length?e.material:e.material?[e.material]:[],o=0;o<a.length;o++){var r=a[o];r.map&&window.renderer.initTexture(r.map),r.name.includes("skybox_material")?e.material.length?a[o]=Ze:e.material=Ze:(a[o].side=L.DoubleSide,a[o].depthWrite=!0,a[o].metalness=0,a[o].roughness=1)}if(_.find((function(t){return e.name.includes(t)}))){if(e.isTrigger=!0,e.visible=!1,e.children){var s,h=Object(P.a)(e.children);try{for(h.s();!(s=h.n()).done;){var c=s.value;c.isTrigger=!0,c.visible=!1}}catch(f){h.e(f)}finally{h.f()}}}else if(e.isMesh){var l,d;if(e.castShadow=!0,e.receiveShadow=!e.isSkinnedMesh,"map-object-0"===e.parent.name&&(e.castShadow=!1,e.receiveShadow=!0),(null===(l=e.geometry)||void 0===l?void 0:l.boundingBox)&&(e.geometry.boundingBox.max.y-e.geometry.boundingBox.min.y<50||e.geometry.boundingBox.max.z-e.geometry.boundingBox.min.z<50||e.geometry.boundingBox.max.x-e.geometry.boundingBox.min.x<50)&&(e.castShadow=!1,e.receiveShadow=!0),e===R.player.children[0]&&(e.castShadow=!0,e.receiveShadow=!1),"lampion.act"===e.name&&(e.castShadow=!1),e.isAlphaMap)return e.castShadow=!1,void(e.receiveShadow=!1);var u="map-object-0"!==(null===(d=e.parent)||void 0===d?void 0:d.name);R.physics.add.existing(e,{shape:"concave",mass:0,collisionFlags:e.isItem?4:u?2:1,autoCenter:!1}),e.body.setAngularFactor(0,0,0),e.body.setLinearFactor(0,0,0)}else if(e.children){var p,m=Object(P.a)(e.children);try{for(m.s();!(p=m.n()).done;){t(p.value)}}catch(f){m.e(f)}finally{m.f()}}}},j=Object(P.a)(this.worldBsp.world.children);try{for(j.s();!(S=j.n()).done;)O=S.value,x(O)}catch(F){j.e(F)}finally{j.f()}case 79:this.showCollider&&this.physics.debug.enable(),null===(e=window.teleporters)||void 0===e||e.forEach((function(t){R.physics.add.collider(t,R.player,(function(e){if(!R.player.teleported||new Date-R.player.teleported>5e3){R.player.teleported=new Date;var i=window.teleporters.indexOf(t),n=i%2===0?1:-1;R.player.teleport(window.teleporters[i+n])}}))})),this.player.teleport=function(t){var e=new L.Vector3;t.getWorldPosition(e),R.player.body.setCollisionFlags(2),R.player.position.set(e.x,e.y,e.z),R.player.body.needUpdate=!0,R.player.body.once.update((function(){R.player.body.setCollisionFlags(0),R.player.body.setVelocity(0,0,0),R.player.body.setAngularVelocity(0,1,0)}))},(A=this.lightManager.createLightPlaceHolder(14463317,2,30)).position.set(0,3,1),A.castShadow=!0,this.player.add(A),this.actor={},T=new L.Raycaster,I=new L.Vector2,this.controlsOffset=new L.Vector3(0,1,0),E=null===(i=Y[this.currentLevelIndex])||void 0===i?void 0:i.rotation,window.mapControls?((C=new fe(this.camera,this.renderer.domElement)).enableDamping=!0,this.controls=C):this.controls=new M.f(this.camera,this.player,{offset:this.controlsOffset,targetRadius:Mi,theta:E||0,phi:15}),this.player.body.setCollisionFlags(2),this.player.rotation.set(this.player.rotation.x,ni(E||0)-Math.PI,this.player.rotation.z),this.player.body.needUpdate=!0,this.player.body.once.update((function(){R.player.body.setCollisionFlags(0),R.player.body.setVelocity(0,0,0),R.player.body.setAngularVelocity(0,1,0)})),!1,window.mapControls&&this.canvas.addEventListener("click",function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e){var i;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:I.x=e.clientX/R.renderer.domElement.clientWidth*2-1,I.y=-e.clientY/R.renderer.domElement.clientHeight*2+1,T.setFromCamera(I,R.camera),i=T.intersectObjects(R.worldBsp.world.children,!0),console.log(i),i=i.filter((function(t){var e,i;return null===(e=t.object)||void 0===e||null===(i=e.material[t.face.materialIndex])||void 0===i?void 0:i.visible})),console.log(i.map((function(t){return t.object.name}))),i.length;case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),wi||window.mapControls||(document.addEventListener("keydown",(function(t){"q"===t.key.toLowerCase()&&localStorage.setItem("position"+window.level,JSON.stringify(R.player.position))})),document.addEventListener("pointerlockchange",(function(){document.pointerLockElement===R.canvas?(document.getElementById("menu").style.display="none",R.playMusic()):(document.getElementById("menu").style.display="flex",R.playerController.input.clearAll())}),!1),this.canvas.addEventListener("click",function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:R.scene.onPointerLock();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),new M.b(this.canvas).onMove((function(t){if(document.pointerLockElement===R.canvas&&Math.abs(t.y)<200&&Math.abs(t.x)<200?(R.moveTop=-t.y*R.mouseSensitivity,R.moveRight=t.x*R.mouseSensitivity):(R.moveTop=0,R.moveRight=0),R.lastControlsUpdate.moveRight!==R.moveRight||R.lastControlsUpdate.moveTop!==R.moveTop){var e=R.canvas.width/R.canvas.height;R.controls.update(3*R.moveRight/e,3*-R.moveTop/e),R.lastControlsUpdate={moveTop:R.moveTop,moveRight:R.moveRight}}}))),this.playerController=new Q(this.player,this,this.canvas,this.worldBsp),this.actorManager.playerController=this.playerController,null===(n=this.levelScript)||void 0===n||n.init(),console.warn("CREATiNG SCENE complete"),L.ShaderChunk.lights_fragment_begin="\n\t\n\tGeometricContext geometry;\n\t\n\tgeometry.position = - vViewPosition;\n\tgeometry.normal = normal;\n\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\t\n\t#ifdef USE_CLEARCOAT\n\t\n\t\tgeometry.clearcoatNormal = clearcoatNormal;\n\t\n\t#endif\n\t\n\tIncidentLight directLight;\n\t\n\t#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\t\n\t\tPointLight pointLight;\n\t\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tPointLightShadow pointLightShadow;\n\t\t#endif\n\t\n        // STANDARD LIGHTS LOOP\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\n\t\t\tpointLight = pointLights[ i ];\n\t\n\t\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\n\t\t\tif (directLight.visible ) {\n\t\n\t\t\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\t\t\tpointLightShadow = pointLightShadows[ i ];\n\t\t\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t\t\t#endif\n\t\t\n\t\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t\t\t}\n\t\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\n\t#endif\n\t\n\t#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\t\n\t\tSpotLight spotLight;\n\t\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tSpotLightShadow spotLightShadow;\n\t\t#endif\n\t\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\n\t\t\tspotLight = spotLights[ i ];\n\t\n\t\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\n\t\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tspotLightShadow = spotLightShadows[ i ];\n\t\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t\t#endif\n\t\n\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\n\t#endif\n\t\n\t#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\t\n\t\tDirectionalLight directionalLight;\n\t\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tDirectionalLightShadow directionalLightShadow;\n\t\t#endif\n\t\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\n\t\t\tdirectionalLight = directionalLights[ i ];\n\t\n\t\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\n\t\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t\t#endif\n\t\n\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\n\t#endif\n\t\n\t#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\t\n\t\tRectAreaLight rectAreaLight;\n\t\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\n\t\t\trectAreaLight = rectAreaLights[ i ];\n\t\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\n\t#endif\n\t\n\t#if defined( RE_IndirectDiffuse )\n\t\n\t\tvec3 iblIrradiance = vec3( 0.0 );\n\t\n\t\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\n\t\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\n\t\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\n\t\t#endif\n\t\n\t#endif\n\t\n\t#if defined( RE_IndirectSpecular )\n\t\n\t\tvec3 radiance = vec3( 0.0 );\n\t\tvec3 clearcoatRadiance = vec3( 0.0 );\n\t\n\t#endif\n\t",L.ShaderChunk.lights_pars_begin=L.ShaderChunk.lights_pars_begin.replace("light.color = pointLight.color;","\n\t\tlight.color = pointLight.color * step( lightDistance, pointLight.distance );\n\t\t"),setTimeout((function(){R.logicUpdate()}),10);case 105:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"logicUpdate",value:function(){var t=this,e=Ti.getDelta();this.actorManager.logicUpdate(e),setTimeout((function(){t.logicUpdate()}),1e3/60)}},{key:"playMusic",value:function(){var t=this;if(!this.audioLoader){this.audioLoader=new L.AudioLoader;var e=Number(window.level?window.level.substring(11,12):0);this.audioLoader.load("sounds/level_"+e+".wav",(function(e){t.sound.setBuffer(e),t.sound.setLoop(!0),t.sound.setVolume(.1),t.sound.play()}));var i=[["RcGen44","RcGen45"],["RcGen67","FLGen29","RcGen68","FLGen30",{fileName:"WKGen3",far:!0},"FLGen31","RcGen70","FLGen32","RcGen71","FLGen33","RcGen72"],["RcGen76","FLGen40","RcGen77","FLGen41","FLGen42","FLGen43","RcGen78"],["FLGen52","RcGen84","FLGen53","FLGen54","RcGen85","RcGen86","FLGen55"],["Grizel14.wav","RcGen64","Grizel8","RcGen5.wav","Grizel9","RcGen79.wav","Grizel12.wav","RcGen93.wav","Grizel10","Grizel16"]];if(!this.playerPositionFromLocalStorage&&i[window.levelIndex]){var n=0;this.voiceManager.stop=!1;!function e(){var a=i[window.levelIndex][n];a&&!t.disposed&&(n++,setTimeout((function(){t.voiceManager.playCutScene(a,(function(){return e()}))}),500))}()}}}},{key:"setScale",value:function(t){this.scale=t||1,this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth*this.scale,window.innerHeight*this.scale)}},{key:"update",value:function(){var t,e,i,n,a,o,r,s,h,c,l,d,u,p=new Date;this.lt=p;var m,f=Ai.getDelta();(null===(t=this.stats)||void 0===t||t.update(),null===(e=this.actor)||void 0===e||null===(i=e.mixer)||void 0===i||i.update(f),null===(n=this.stats)||void 0===n||n.update(),null===(a=this.vertexNormalHelper)||void 0===a||a.update(),null===(o=this.wireframeMixer)||void 0===o||o.update(f),!this.firstRenderComplete&&this.playerPositionFromLocalStorage)&&(null===(m=this.playerController)||void 0===m||m.AnimateSpawn());null===(r=this.playerController)||void 0===r||r.Update(f),null===(s=this.worldBsp)||void 0===s||null===(h=s.updateLoops)||void 0===h||h.forEach((function(t){return t(f)})),null===(c=this.actorManager)||void 0===c||c.update(f),null===(l=this.fleurifee)||void 0===l||l.update(f);var y=this.canvas.width/this.canvas.height;if(wi?this.controls.update(this.playerController.input.angle/5,this.playerController.input.topAngle/5):(this.controls.update(3*this.moveRight/y,3*-this.moveTop/y),this.lastControlsUpdate={moveTop:this.moveTop,moveRight:this.moveRight}),wi||(this.moveRight=this.moveTop=0),!this.playerController.dead){var g=new L.Vector3,b=this.camera.getWorldDirection(g),v=Math.atan2(b.x,b.z),_=this.player.getWorldDirection(g),k=Math.atan2(_.x,_.z);this.player.body.setAngularVelocityY(0);var x=Math.abs(v-k),j=wi?2:20,S=Math.PI/24;x>S?(x>Math.PI-S&&(j*=-2),v<k&&(j*=-2),this.rotating=Math.min((this.rotating||0)+f,1),this.player.body.setAngularVelocityY(this.rotating*j)):this.rotating=0}var O=new L.Vector3,A=this.player.position.clone();A.add(this.controlsOffset),O.subVectors(this.camera.position,A).normalize();var T=new L.Raycaster(A,O,0,Mi);T.camera=this.camera;var P=T.intersectObjects((null===(d=this.worldBsp)||void 0===d||null===(u=d.world.children)||void 0===u?void 0:u.filter((function(t){return!t.isSkinnedMesh})))||[],!0).filter((function(t){var e;return null===(e=t.object)||void 0===e?void 0:e.visible}));if(P.length>0){var M=Math.max(Math.max.apply(Math,Object(w.a)(P.map((function(t){return t.distance}))))-4,.1);M<this.controls.radius?(this.controls.radius=M,this.controls.targetRadius=this.controls.radius):this.controls.targetRadius=L.MathUtils.lerp(this.controls.targetRadius,M,2*f),this.targetRadiusSmooth=M}else this.targetRadiusSmooth=Mi,this.controls.targetRadius=L.MathUtils.lerp(this.controls.targetRadius,this.targetRadiusSmooth,2*f);this.firstRenderComplete||(this.firstRenderComplete=!0,this.scene.loadingComplete&&this.scene.loadingComplete(),this.startTime=performance.now()),this.camera.updateProjectionMatrix(),this.lightManager.update(f)}},{key:"loadActor",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e){var i,n,a,o,r,s,h,c,l,d,u,p,m,f=arguments;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.length>1&&void 0!==f[1]?f[1]:.1,n=f.length>2&&void 0!==f[2]?f[2]:0,a=f.length>3&&void 0!==f[3]?f[3]:2,o=f.length>4&&void 0!==f[4]?f[4]:0,r=!(f.length>5&&void 0!==f[5])||f[5],s=f.length>6?f[6]:void 0,t.next=8,Ce(e);case 8:return h=t.sent,this.actor,c=Se(h,e),l=c.mesh,d=c.mixer,u=c.motions,p=c.wireframeMixer,console.log(l),this.wireframeMixer=p,l.mixer=d,s&&l.rotation.set(s.x,s.y,s.z),l.castShadow=!0,l.receiveShadow=!1,this.mixer=d,this.motions=u,this.currentMotion="Default pose",l.scale.setScalar(i),(new L.Box3).setFromObject(l),m=new L.Object3D,l.scale.setScalar(i),l.position.set(n,a,o),m.add(l),r?(2,1,l.position.set(0,-2,0),m.position.set(n,a,o),this.physics.add.existing(m,{mass:2,shape:"capsule",radius:1,height:2}),m.body.setCollisionFlags(Ne.DYNAMIC),m.body.setFriction(0),m.body.setAngularFactor(0,1,0)):(this.physics.add.existing(m,{shape:"mesh",mass:1}),m.body.setCollisionFlags(Ne.STATIC)),m.mixer=d,m.animations=l.animations,this.scene.add(m),this.actor=l,this.actorname=e,this.setupDatGui(l,e),t.abrupt("return",m);case 35:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"downloadAllActors",value:function(){var t=Object(le.a)(Object(ce.a)().mark((function t(){var e,i,n,a;return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("OK"),e=Object(P.a)(Te),t.prev=2,e.s();case 4:if((i=e.n()).done){t.next=14;break}return n=i.value,t.next=8,this.loadActor(n);case 8:return a=t.sent,Pi(a,n),t.next=12,new Promise((function(t){return setTimeout(t,1e3)}));case 12:t.next=4;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(2),e.e(t.t0);case 19:return t.prev=19,e.f(),t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[2,16,19,22]])})));return function(){return t.apply(this,arguments)}}()},{key:"initStats",value:function(){var t=new ue.a;return t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",document.getElementById("Stats-output").appendChild(t.domElement),t}},{key:"setupDatGui",value:function(t,e){var i=this;this.gui&&this.gui.destroy(),this.gui=new Ae.a({title:"Debug controls (advanced)"});var n=this.gui.addFolder("General Options");if(this.gui.close(),window.location.href.includes("localhost")){var a={add:function(){i.downloadAllActors()}};this.gui.add(a,"add").name("Download all actors to .glb");var o={add:function(){t.position.set(0,0,0),Pi(t,e)}};this.gui.add(o,"add").name("Download .glb");var r={add:function(){var e=(new Oe.a).parse(t);!function(t,e){var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}(this.currentActor+".stl",e)}};this.gui.add(r,"add").name("Download .stl")}this.gui.add(window,"level",[0,1,2,3,4,"debug"]).name("Level").onChange((function(t){i.scene.loadLevel(t)})),this.gui.add(window,"mapControls").name("Fly controls").onChange((function(t){console.log(t),localStorage.setItem("mapControls",t?"1":"0"),window.location.reload()})),n.add(this,"currentActor",Te).name("Current actor").onChange(function(){var t=Object(le.a)(Object(ce.a)().mark((function t(e){return Object(ce.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.loadActor(e,.1,i.player.position.x+2,i.player.position.y+4,i.player.position.z);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n.add(this,"showCollider").name("Show collision box").onChange((function(t){t?i.physics.debug.enable():i.physics.debug.disable()})),n.add(this,"currentMotion",["Default pose"].concat(this.motions.map((function(t){return t.name})))).name("Motion").onChange((function(t){var e,n;null===(e=i.mixer)||void 0===e||e.stopAllAction(),null===(n=i.wireframeMixer)||void 0===n||n.stopAllAction();var a=i.actor.animations[t];a&&a.action.play()}));var s=t.skeleton.bones,h=this.gui.addFolder("Mesh");h.add(t.position,"x",-4+t.position.x,4+t.position.x).name("position.x"),h.add(t.position,"y",-4+t.position.y,4+t.position.y).name("position.y"),h.add(t.position,"z",-4+t.position.z,4+t.position.z).name("position.z"),h.add(t.rotation,"x",1*-Math.PI,1*Math.PI).name("rotation.x"),h.add(t.rotation,"y",1*-Math.PI,1*Math.PI).name("rotation.y"),h.add(t.rotation,"z",1*-Math.PI,1*Math.PI).name("rotation.z");var c=this.gui.addFolder("Boners");c.close();for(var l=0;l<s.length;l++){var d=s[l];n=c.addFolder(d.uuid),0!==l&&n.close(),n.add(d.position,"x",-4+d.position.x,4+d.position.x),n.add(d.position,"y",-4+d.position.y,4+d.position.y),n.add(d.position,"z",-4+d.position.z,4+d.position.z),n.add(d.rotation,"x",1*-Math.PI,1*Math.PI),n.add(d.rotation,"y",1*-Math.PI,1*Math.PI),n.add(d.rotation,"z",1*-Math.PI,1*Math.PI),n.add(d.scale,"x",0,2),n.add(d.scale,"y",0,2),n.add(d.scale,"z",0,2),n.controllers[0].name("position.x"),n.controllers[1].name("position.y"),n.controllers[2].name("position.z"),n.controllers[3].name("rotation.x"),n.controllers[4].name("rotation.y"),n.controllers[5].name("rotation.z"),n.controllers[6].name("scale.x"),n.controllers[7].name("scale.y"),n.controllers[8].name("scale.z")}}},{key:"dispose",value:function(){var t=this;this.disposed=!0,this.sound.stop(),this.renderer.dispose(),document.body.removeChild(this.canvas),this.scene.traverse((function(e){e.isEntity&&t.scene.remove(e)})),this.physics.rigidBodies.forEach((function(e){return t.physics.destroy(e)})),this.disposables.forEach((function(t){return t()})),this.voiceManager.dispose(),this.actorManager.reset()}}]),i}(M.d);var Ei=function(t){window.devicePixelRatio;var e={scenes:[Ii],renderer:new L.WebGLRenderer({powerPreference:"high-performance"})};Object(M.a)("/lib",(function(){var i=new M.c(e);return t(i),i}))};function Ci(t){return"levels/lvl0".concat(t,"a.bsp")}var Ri,Fi,Di,Ni,Bi,zi,Gi,Ui,Wi,Hi,Vi,Ki,Xi,Yi,Ji,qi,Qi=i(226),Zi=i(225),$i=i(139),tn=i(42),en=i.n(tn),nn=i(140),an=i.n(nn),on=(i(216),{"/":[{title:"Remake van Redcat Spookkasteel speelbaar in de browser",text:"Redcat Spookkasteel is een game die is uitgebracht in een tijdperk waarin 3D-gaming nog in de kinderschoenen stond, maakte indruk met zijn unieke gameplay en sfeervolle/griezellige omgevingen. Decennia later besloot ik om de uitdaging aan te gaan om dit nostalgische meesterwerk te moderniseren en de ervaring te leveren die Redcat en de fans verdienen."},{title:"",text:"Door gebruik te maken reverse engineering en andere trucjes, doe ik een poging om deze game niew leven in te blazen en spelers de kans te geven dit spook avontuur opnieuw te beleven direct in de webbrowser!"},{title:"Reverse Engineering",text:Object(f.jsxs)(f.Fragment,{children:["Ik begon met het analyzeren van de bestanden van de game. Al snel vond ik configuratie bestanden waarin duidelijk werd dat er gebruik wordt gemaakt van de ",Object(f.jsx)("a",{href:"https://www.genesis3d.com/",children:"Genesis3D Open Source Engine"}),". Deze engine maakt gebruik van oude bestandstypes (.act voor 3D-modellen en characters, en .bsp voor de werelden), die niet meer gebruikt worden in modernere game engines. Deze files bevatten binare data en zijn niet gemakkelijk te lezen. In de ",Object(f.jsx)("a",{href:"https://github.com/RealityFactory/Genesis3D",children:"source code"})," van de Genesis 3D-engine heb ik achterhaalt hoe deze binare files zijn opgeslagen om ze vervolgens weer terug te vertalen naar bruikbare data. Om dit te parsen heb ik een tool gebruikt genaamd ",Object(f.jsx)("a",{href:"https://kaitai.io/",children:"Kaitai Struct"}),"."]})},{text:Object(f.jsxs)(f.Fragment,{children:["Na heel wat reverse engineren en hulp van een begin van een ",Object(f.jsx)("a",{href:"https://github.com/Game3DEE/adoom",children:"remake van Amsterdoom"})," heb ik alle 3d modellen, textures, animaties en nog veel meer informatie over de game kunnen terug vinden."]})},{text:Object(f.jsxs)(f.Fragment,{children:["Na maanden van hard werken, kan ik een ",Object(f.jsx)("a",{href:"/game",children:"voorproefje"})," van mijn werk delen. Dit is de demo van de remake van Redcat Spookkasteel, waarin je kunt rondlopen in de originele levels."]})},{title:"Beperkingen",text:Object(f.jsxs)(f.Fragment,{children:["Uiteindelijk liep ik tegen een aantal beperkingen aan van de technieken die ik gebruik om dit allemaal in web te draaien (Webgl en ",Object(f.jsx)("a",{href:"https://threejs.org/",children:"three.js"}),"). Ten eerste is de tooling in three.js redelijk beperkt en hierdoor moet ik heel veel basis elementen zelf maken. Zoals de third-person controller, cutscenes en npc's. Ten tweede is de performance niet super goed. Om de performance te verbeteren heb ik zelf scripts moeten maken om niet te veel lichten en 3d modellen tegelijkertijd te renderen."]})},{title:"Nieuwe Redcat game",text:Object(f.jsxs)(f.Fragment,{children:["Toen ik er ook achter kwam dat de 3d modellen van de werelden niet zo goed in elkaar zitten (zoals ",Object(f.jsx)("a",{href:"https://en.wikipedia.org/wiki/Normal_(geometry)",children:"normals"})," die soms naar binnen wijzen), heb ik besloten naast mijn remake, ook nog een ",Object(f.jsx)("a",{href:"/remaster",children:"geremasterde"})," versie te maken van Redcat Spookkasteel. Sommige 3D modellen van het origineel gebruik ik hier in wel zoals Redcat, Brutus, Max en Zombies. Maar de levels en het verhaal maak ik compleet opnieuw in een modern jasje."]})}],"/remaster":[{title:"Nieuwe Levels, Nieuw Verhaal",text:'Hoewel ik enkele elementen van verhaallijnen heb overgenomen uit de oude Redcat-games, met name dus uit "Spookkasteel", is dit project geen kopie. Integendeel, ik heb de kans gegrepen om mijn creativiteit de vrije loop te laten en volledig nieuwe levels te maken en een nieuw verhaallijn te bedenken. Het verhaal dat ik heb bedacht, bouwt voort op de magische sfeer van het origineel, terwijl het ook nieuwe wendingen en uitdagingen bevat om spelers te verrassen en uit te dagen.'},{title:"Een Nieuw Hoofdstuk in Redcat's Avontuur",text:'Mijn doel met dit project is om een eerbetoon te brengen aan het originele "Redcat Spookkasteel", terwijl ik ook mijn eigen stempel druk op het Redcat-universum. Het voelt als een eer om de erfenis van dat klassieke spel voort te zetten en tegelijkertijd iets nieuws en unieks te cre\xebren voor zowel oude als nieuwe fans van het genre.'},{text:"Hoewel ik nog in de vroege stadia van de ontwikkeling ben, ben ik verheugd om alvast een glimp te delen van wat jullie kunnen verwachten. Mijn Unreal Engine-project zal spelers meenemen op een avontuur vol betovering, mysteries en uitdagingen."},{text:"Dank jullie wel voor het lezen van deze blogpost en voor jullie interesse in mijn nieuwe gameproject. Blijf op de hoogte voor meer updates en onthullingen in de toekomst!"}]}),rn={new_game:"Nieuwe game",play_demo:"Speel demo online"},sn="nl",hn={"/":[{title:"Redcat Spookkasteel Remake playable in the browser",text:"Redcat Spookkasteel (Redcat Haunted Castle) is a dutch game that was released in an era when 3D gaming was still in its infancy. It made an impression with its unique gameplay and atmospheric/spooky environments. Decades later, I decided to take on the challenge of modernizing this nostalgic masterpiece and delivering the experience that Redcat and the fans deserve."},{title:"Reverse Engineering",text:Object(f.jsxs)(f.Fragment,{children:["I began by analyzing the game's files. Soon, I found configuration files that revealed the use of the ",Object(f.jsx)("a",{href:"https://www.genesis3d.com/",children:"Genesis3D Open Source Engine"}),". This engine employs outdated file formats (.act for 3D models and characters, and .bsp for worlds) that are no longer in use in more modern game engines. These files contain binary data and are not easily readable. In the ",Object(f.jsx)("a",{href:"https://github.com/RealityFactory/Genesis3D",children:"source code"})," of the Genesis 3D engine, I deciphered how these binary files are structured, enabling me to translate them back into usable data. To parse this information, I utilized a tool called ",Object(f.jsx)("a",{href:"https://kaitai.io/",children:"Kaitai Struct"}),"."]})},{text:Object(f.jsxs)(f.Fragment,{children:["After a considerable amount of reverse engineering and with the assistance of a nascent ",Object(f.jsx)("a",{href:"https://github.com/Game3DEE/adoom",children:"Amsterdoom remake"}),", I managed to rediscover all 3D models, textures, animations, and a wealth of other information about the game."]})},{text:Object(f.jsxs)(f.Fragment,{children:["After months of hard work, I am delighted to share a ",Object(f.jsx)("a",{href:"/game",children:"sneak peek"})," of my efforts. This is the demo of the Redcat Haunted Castle remake, allowing you to navigate through the original levels."]})},{title:"Limitations",text:Object(f.jsxs)(f.Fragment,{children:["Ultimately, I encountered several limitations with the techniques I'm using to run all of this on the web (WebGL and ",Object(f.jsx)("a",{href:"https://threejs.org/",children:"three.js"}),"). Firstly, the tooling in three.js is somewhat limited, which requires me to create many basic elements myself, such as the third-person controller, cutscenes, and NPCs. Secondly, the performance isn't optimal. To enhance performance, I had to write my own scripts to manage the rendering of too many lights and 3D models simultaneously."]})},{title:"New Redcat game",text:Object(f.jsxs)(f.Fragment,{children:["When I also discovered that the 3D models of the environments weren't well put together (such as ",Object(f.jsx)("a",{href:"https://en.wikipedia.org/wiki/Normal_(geometry)",children:"normals"})," that sometimes pointed inward), I decided that in addition to my remake, I would also create a ",Object(f.jsx)("a",{href:"/remaster",children:"remastered"})," version of Redcat Haunted Castle. I'm using some of the original 3D models here, like Redcat, Brutus, Max, and Zombies. However, I'm completely reimagining the levels and the storyline in a modern style."]})}],"/remaster":[{title:"New Levels, New Story",text:"While I've incorporated certain story elements from the old Redcat games, particularly from \"Spookkasteel\" this project is not a mere copy. On the contrary, I've taken the opportunity to unleash my creativity and craft entirely new levels while devising a fresh storyline. The narrative I've developed builds upon the magical atmosphere of the original, while also introducing new twists and challenges to surprise and engage players."},{title:"A New Chapter in Redcat's Adventure",text:"My goal with this project is to pay homage to the original 'Redcat Haunted Castle,' while also leaving my own mark on the Redcat universe. It's an honor to carry forward the legacy of that classic game while simultaneously crafting something fresh and distinctive for both longstanding and new fans of the genre."},{text:"While I'm still in the early stages of development, I'm excited to offer a sneak peek of what you can expect. My Unreal Engine project will take players on an adventure filled with enchantment, mysteries, and challenges."},{text:"Thank you for reading this blog post and for your interest in my new game project. Stay tuned for more updates and unveilings in the future!"}]},cn={new_game:"New game",play_demo:"Play demo online"},ln="eng",dn=[n,a],un=new(function(){function t(){Object(k.a)(this,t)}return Object(x.a)(t,[{key:"setLang",value:function(t){var e=this;window.localStorage.setItem("lang",t),this.lang=t,this.strings=dn.find((function(t){return t.Lang===e.lang}))}},{key:"getString",value:function(t){var e;return(null===(e=this.strings)||void 0===e?void 0:e.Text[t])||"Translation not found"}},{key:"getBlog",value:function(t){var e;return(null===(e=this.strings)||void 0===e?void 0:e.Blog[t])||["Translation not found"]}}]),t}()),pn=m.a.div(Ri||(Ri=Object(p.a)(["\n    position: fixed;\n    left: 0;\n    right: 0;\n    top: 0;\n    z-index: 999;\n    background-color: #0f172a;\n    border-width: 0;\n    border-bottom-width: 2px;\n    border-bottom-left-radius: 12px;\n    border-bottom-right-radius: 12px;\n    border-style: solid;\n    border-color: rgb(29, 40, 58);\n    background: url('img/background.jpeg');\n"]))),mn=m.a.div(Fi||(Fi=Object(p.a)(["\n    display: flex;\n    margin-top: 20px;\n    gap: 12px;\n    justify-content: center;\n"]))),fn=m.a.a(Di||(Di=Object(p.a)(["\n    border-color: hsla(0,0%,100%,.5);\n    color: rgb(225, 231, 239);\n    text-decoration: none;\n    cursor: pointer;\n\n    border-style: solid;\n    border-width: 0;\n\n    padding-bottom: 8px;\n    border-bottom-width: ",";\n"])),(function(t){var e=t.href;return window.location.pathname===e?"2px":"0px"})),yn=m.a.img(Ni||(Ni=Object(p.a)(["\n    height: 140px;\n    margin: 0 auto;\n    margin-top: 12px;\n    ",";\n    ",";\n    display: block;\n    border: 1px solid rgb(100, 100, 100);\n    border-radius: 4px;\n    box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;\n"])),(function(){return window.mobileCheck()?"height: 100px":null}),(function(){return window.mobileCheck()?"opacity: 0":null})),gn=m.a.span(Bi||(Bi=Object(p.a)(["\n\n"]))),bn=m.a.div(zi||(zi=Object(p.a)(["\n    position: fixed;\n    right: 12px;\n    margin-top: -12px;\n    ",";\n"])),(function(){return window.mobileCheck()?"margin-top: -50px":null})),vn={nl:"Dutch",eng:"English"},_n=m.a.img(Gi||(Gi=Object(p.a)(["\n    height: 50px;\n    border-radius: 100%;\n    margin-right: 8px;\n"]))),wn=m.a.a(Ui||(Ui=Object(p.a)(["\n    position: fixed;\n    display: table;\n\n    left: 80px;\n    top: 40px;\n\n    ",";\n    ",";\n\n    cursor: pointer;\n    text-decoration: none;\n    color: rgb(225, 231, 239);\n    padding: 4px;\n    border-radius: 8px;\n\n    &:hover {\n        background-color: #54545473;\n    }\n\n"])),(function(){return window.mobileCheck()?"left: 20px":null}),(function(){return window.mobileCheck()?"top: 8px":null})),kn=m.a.span(Wi||(Wi=Object(p.a)(["\n    display: table-cell;\n    vertical-align: middle;\n"])));function xn(){var t=vn[un.lang];return Object(f.jsxs)(pn,{id:"blog-header",children:[Object(f.jsxs)(wn,{href:"https://www.linkedin.com/in/jildert-venema-403882158/",children:[Object(f.jsx)(_n,{src:"img/developer.jpeg"}),Object(f.jsx)(kn,{children:"Jildert"})]}),Object(f.jsx)(yn,{src:"img/logo.jpg"}),Object(f.jsxs)(bn,{children:[Object(f.jsx)(gn,{children:"Language"}),Object(f.jsx)(an.a,{options:Object.values(vn),onChange:function(t){un.setLang(Object.entries(vn).find((function(e){return e[1]===t.value}))[0]),window.location.reload()},value:t,placeholder:"Select an option"})]}),Object(f.jsx)("a",{className:"play-button",href:"/game",children:un.getString("play_demo")}),Object(f.jsxs)(mn,{children:[Object(f.jsx)(fn,{href:"/",children:"Remake Spookkasteel"}),Object(f.jsx)(fn,{href:"/remaster",children:un.getString("new_game")})]})]})}var jn=m.a.div(Hi||(Hi=Object(p.a)(["\nmargin-bottom: 100px;\n"]))),Sn=m.a.div(Vi||(Vi=Object(p.a)(["\n    color: rgb(225, 231, 239);\n    padding-right: 2rem;\n    padding-left: 2rem;\n    max-width: 800px;\n    margin: 0 auto;\n    line-height: 1.5;\n"]))),On=m.a.p(Ki||(Ki=Object(p.a)(["\n    color: rgb(225, 231, 239);\n\n    a {\n        color: rgb(182, 213, 255);\n    }\n"]))),An=m.a.div(Xi||(Xi=Object(p.a)(["\n\n"]))),Tn=m.a.img(Yi||(Yi=Object(p.a)(["\n    width: 100%;\n    max-height: 500px;\n"]))),Ln=m.a.h1(Ji||(Ji=Object(p.a)(["\n    font-size: 1.875rem;\n    line-height: 2.25rem;\n    font-weight: 700;\n    color: rgb(225, 231, 239);\n"]))),Pn=m.a.video(qi||(qi=Object(p.a)(["\n    width: 100%;\n    max-height: 500px;\n"]))),Mn={"/":[{src:"img/blog-0.webp",alt:"Debug level",href:"/game"},0,0,0,{src:"img/blog-1.webp",alt:"Level 1 - Het bos",href:"/game"}]},In={"/remaster":["video/blog-0.mp4",0,0,"video/blog-1.mp4"]},En=(/^en\b/.test(navigator.language),window.localStorage.getItem("lang"));En?(un.setLang(En),console.log(En)):un.setLang("nl");var Cn=function(t){if(!t)return null;var e=function(){return Object(f.jsx)(Tn,{src:t.src,alt:t.alt})};return t.href?Object(f.jsx)("a",{href:t.href,children:e()}):e()},Rn=function(){var t=Object(s.useState)(0),e=Object(u.a)(t,2),i=e[0],n=e[1];Object(s.useEffect)((function(){n(a())}),[]);var a=function(){var t,e;return null!==(t=null===(e=document.getElementById("blog-header"))||void 0===e?void 0:e.clientHeight)&&void 0!==t?t:0},o=un.getBlog(window.location.pathname),r=Mn[window.location.pathname]||[],h=In[window.location.pathname]||[];return Object(f.jsxs)(jn,{children:[Object(f.jsx)(xn,{}),Object(f.jsx)("div",{style:{marginTop:i+12}}),Object(f.jsx)(Sn,{children:o.map((function(t,e){var i=t.text,n=t.title;return Object(f.jsxs)(An,{children:[n?Object(f.jsx)(Ln,{children:n}):null,Cn(r[e]),h[e]?Object(f.jsx)(Pn,{controls:!0,src:h[e]}):null,Object(f.jsx)(On,{children:i})]},e)}))}),Object(f.jsx)(b,{})]})};i(217),i(218),i(219),i(220);!function(){try{var t=JSON.parse(localStorage.getItem(It));if(t)for(var e=0,i=Object.keys(dt.Settings);e<i.length;e++){var n=i[e];t.hasOwnProperty(n)&&(dt.Settings[n]=t[n])}}catch(a){}}();var Fn=!en.a.env.NODE_ENV||"development"===en.a.env.NODE_ENV;$i.a.install({THREE:L}),Fn||Qi.a({dsn:"https://2d24caabf33941d0b557b69bcd881278@o4505042309283840.ingest.sentry.io/4505042310397952",integrations:[new Zi.a],tracesSampleRate:1});var Dn=document.getElementById("root"),Nn=l.a.createRoot(Dn);window.mobileCheck=function(){var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},"/game"===window.location.pathname?Ei((function(t){Nn.render(Object(f.jsx)(h.a.StrictMode,{children:Object(f.jsx)(se,{initialProject:t,initScene:Ei})}))})):(Dn.id="root-blog",Nn.render(Object(f.jsx)(h.a.StrictMode,{children:Object(f.jsx)(Rn,{})}))),he()},48:function(t,e,i){var n,a,o;window.self;a=[i(95)],void 0===(o="function"===typeof(n=function(t){return function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}e.ChunkType=Object.freeze({HEADER:0,MODELS:1,NODES:2,BNODES:3,LEAFS:4,CLUSTERS:5,AREAS:6,AREA_PORTALS:7,LEAF_SIDES:8,PORTAL:9,PLANES:10,FACES:11,LEAF_FACES:12,VERT_INDEX:13,VERTS:14,RGB_VERTS:15,ENTDATA:16,TEXINFOS:17,TEXTURES:18,TEXDATA:19,LIGHTDATA:20,VISDATA:21,SKY_DATA:22,PALETTES:23,MOTIONS:24,END:65535,0:"HEADER",1:"MODELS",2:"NODES",3:"BNODES",4:"LEAFS",5:"CLUSTERS",6:"AREAS",7:"AREA_PORTALS",8:"LEAF_SIDES",9:"PORTAL",10:"PLANES",11:"FACES",12:"LEAF_FACES",13:"VERT_INDEX",14:"VERTS",15:"RGB_VERTS",16:"ENTDATA",17:"TEXINFOS",18:"TEXTURES",19:"TEXDATA",20:"LIGHTDATA",21:"VISDATA",22:"SKY_DATA",23:"PALETTES",24:"MOTIONS",65535:"END"}),e.prototype._read=function(){for(this.chunks=[];!this._io.isEof();)this.chunks.push(new i(this._io,this,this._root))};var i=e.Chunk=function(){function i(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return i.prototype._read=function(){if(this.type=this._io.readS4le(),this.elementSize=this._io.readS4le(),this.elementCount=this._io.readS4le(),!this.isDataChunkType&&!this.isEntData){this._raw_elements=[],this.elements=[];for(var i=0;i<this.elementCount;i++){var s;switch(this.type){case e.ChunkType.LEAF_SIDES:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new g(s,this,this._root));break;case e.ChunkType.HEADER:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new b(s,this,this._root));break;case e.ChunkType.PLANES:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new a(s,this,this._root));break;case e.ChunkType.TEXTURES:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new k(s,this,this._root));break;case e.ChunkType.PORTAL:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new h(s,this,this._root));break;case e.ChunkType.NODES:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new _(s,this,this._root));break;case e.ChunkType.CLUSTERS:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new l(s,this,this._root));break;case e.ChunkType.AREA_PORTALS:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new r(s,this,this._root));break;case e.ChunkType.BNODES:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new m(s,this,this._root));break;case e.ChunkType.VERTS:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new w(s,this,this._root));break;case e.ChunkType.VERT_INDEX:this.elements.push(this._io.readU4le());break;case e.ChunkType.AREAS:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new n(s,this,this._root));break;case e.ChunkType.SKY_DATA:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new c(s,this,this._root));break;case e.ChunkType.FACES:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new d(s,this,this._root));break;case e.ChunkType.MODELS:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new o(s,this,this._root));break;case e.ChunkType.TEXINFOS:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new v(s,this,this._root));break;case e.ChunkType.LEAFS:this._raw_elements.push(this._io.readBytes(this.elementSize)),s=new t(this._raw_elements[i]),this.elements.push(new u(s,this,this._root));break;default:this.elements.push(this._io.readBytes(this.elementSize))}}}if(this.isDataChunkType&&(this.data=this._io.readBytes(this.elementSize*this.elementCount)),this.isEntData){this._raw_entityList=this._io.readBytes(this.elementSize*this.elementCount);var p=new t(this._raw_entityList);this.entityList=new y(p,this,this._root)}},Object.defineProperty(i.prototype,"isEntData",{get:function(){return void 0!==this._m_isEntData||(this._m_isEntData=this.type==e.ChunkType.ENTDATA),this._m_isEntData}}),Object.defineProperty(i.prototype,"isDataChunkType",{get:function(){return void 0!==this._m_isDataChunkType||(this._m_isDataChunkType=this.type==e.ChunkType.TEXDATA||this.type==e.ChunkType.LIGHTDATA),this._m_isDataChunkType}}),i}(),n=e.Area=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.areaPortalCount=this._io.readS4le(),this.firstAreaPortal=this._io.readS4le()},t}(),a=e.Plane=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.normal=new w(this._io,this,this._root),this.dist=this._io.readF4le(),this.type=this._io.readS4le()},t}(),o=e.Model=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.rootNode=[];for(var t=0;t<2;t++)this.rootNode.push(this._io.readS4le());for(this.minS=new w(this._io,this,this._root),this.maxS=new w(this._io,this,this._root),this.origin=new w(this._io,this,this._root),this.faceStart=this._io.readS4le(),this.faceCount=this._io.readS4le(),this.leafStart=this._io.readS4le(),this.leafCount=this._io.readS4le(),this.clusterStart=this._io.readS4le(),this.clusterCount=this._io.readS4le(),this.areas=[],t=0;t<2;t++)this.areas.push(this._io.readS4le());this.invalidMotionPtr=this._io.readU4le()},t}(),r=e.AreaPortal=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.modelNum=this._io.readS4le(),this.area=this._io.readS4le()},t}(),s=e.SystemTime=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.year=this._io.readS2le(),this.month=this._io.readS2le(),this.dayOfWeek=this._io.readS2le(),this.day=this._io.readS2le(),this.hour=this._io.readS2le(),this.minute=this._io.readS2le(),this.second=this._io.readS2le(),this.milliseconds=this._io.readS2le()},t}(),h=e.Portal=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.origin=new w(this._io,this,this._root),this.leafTo=this._io.readS4le()},t}(),c=e.SkyData=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.axis=new w(this._io,this,this._root),this.degreesPerMinute=this._io.readF4le(),this.textures=[];for(var t=0;t<6;t++)this.textures.push(this._io.readS4le());this.drawScale=this._io.readF4le()},t}(),l=e.Cluster=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.visOfs=this._io.readS4le()},t}(),d=e.Face=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.vertStart=this._io.readS4le(),this.vertCount=this._io.readS4le(),this.planeCount=this._io.readS4le(),this.planeSide=this._io.readS4le(),this.texInfo=this._io.readS4le(),this.lightOffset=this._io.readS4le(),this.lWidth=this._io.readS4le(),this.lHeight=this._io.readS4le(),this.lTypes=[];for(var t=0;t<4;t++)this.lTypes.push(this._io.readU1())},t}(),u=e.Leaf=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.contents=this._io.readS4le(),this.minS=new w(this._io,this,this._root),this.maxS=new w(this._io,this,this._root),this.firstFace=this._io.readS4le(),this.faceCount=this._io.readS4le(),this.firstPortal=this._io.readS4le(),this.portalCount=this._io.readS4le(),this.cluster=this._io.readS4le(),this.area=this._io.readS4le(),this.firstSide=this._io.readS4le(),this.sideCount=this._io.readS4le()},t}(),p=e.Entity=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.pairCount=this._io.readU4le(),this.pairs=[];for(var t=0;t<this.pairCount;t++)this.pairs.push(new f(this._io,this,this._root))},t}(),m=e.Bnode=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.children=[];for(var t=0;t<2;t++)this.children.push(this._io.readS4le());this.planeNum=this._io.readS4le()},t}(),f=e.EntityPair=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.keyLen=this._io.readU4le(),this.key=t.bytesToStr(t.bytesTerminate(this._io.readBytes(this.keyLen),0,!1),"utf-8"),this.valueLen=this._io.readU4le(),this.value=t.bytesToStr(t.bytesTerminate(this._io.readBytes(this.valueLen),0,!1),"utf-8")},e}(),y=e.EntityList=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.numEntities=this._io.readU4le(),this.entities=[];for(var t=0;t<this.numEntities;t++)this.entities.push(new p(this._io,this,this._root))},t}(),g=e.LeafSide=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.planeCount=this._io.readS4le(),this.planeSide=this._io.readS4le()},t}(),b=e.Header=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){if(this.magic=this._io.readBytes(8),0!=t.byteArrayCompare(this.magic,[71,66,83,80,0,0,0,0]))throw new t.ValidationNotEqualError([71,66,83,80,0,0,0,0],this.magic,this._io,"/types/header/seq/0");this.version=this._io.readU4le(),this.bspTime=new s(this._io,this,this._root)},e}(),v=e.TextureInfo=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.vecs=[];for(var t=0;t<2;t++)this.vecs.push(new w(this._io,this,this._root));for(this.shift=[],t=0;t<2;t++)this.shift.push(this._io.readF4le());for(this.drawScale=[],t=0;t<2;t++)this.drawScale.push(this._io.readF4le());this.flags=this._io.readS4le(),this.faceLight=this._io.readF4le(),this.reflectiveScale=this._io.readF4le(),this.alpha=this._io.readF4le(),this.mipMapBias=this._io.readF4le(),this.texture=this._io.readS4le()},t}(),_=e.Node=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.children=[];for(var t=0;t<2;t++)this.children.push(this._io.readS4le());this.faceCount=this._io.readS4le(),this.firstFace=this._io.readS4le(),this.planeNum=this._io.readS4le(),this.minS=new w(this._io,this,this._root),this.maxS=new w(this._io,this,this._root)},t}(),w=e.Vector3=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.x=this._io.readF4le(),this.y=this._io.readF4le(),this.z=this._io.readF4le()},t}(),k=e.Texture=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.name=t.bytesToStr(t.bytesTerminate(this._io.readBytes(32),0,!1),"utf-8"),this.flags=this._io.readU4le(),this.width=this._io.readS4le(),this.height=this._io.readS4le(),this.offset=this._io.readS4le(),this.paletteIndex=this._io.readS4le()},Object.defineProperty(e.prototype,"fFullbright",{get:function(){return void 0!==this._m_fFullbright||(this._m_fFullbright=0!=(2&this.flags)),this._m_fFullbright}}),Object.defineProperty(e.prototype,"fSky",{get:function(){return void 0!==this._m_fSky||(this._m_fSky=0!=(4&this.flags)),this._m_fSky}}),Object.defineProperty(e.prototype,"fTransparent",{get:function(){return void 0!==this._m_fTransparent||(this._m_fTransparent=0!=(16&this.flags)),this._m_fTransparent}}),Object.defineProperty(e.prototype,"fGouraud",{get:function(){return void 0!==this._m_fGouraud||(this._m_fGouraud=0!=(32&this.flags)),this._m_fGouraud}}),Object.defineProperty(e.prototype,"fMirror",{get:function(){return void 0!==this._m_fMirror||(this._m_fMirror=0!=(1&this.flags)),this._m_fMirror}}),Object.defineProperty(e.prototype,"fFlat",{get:function(){return void 0!==this._m_fFlat||(this._m_fFlat=0!=(64&this.flags)),this._m_fFlat}}),Object.defineProperty(e.prototype,"fLight",{get:function(){return void 0!==this._m_fLight||(this._m_fLight=0!=(8&this.flags)),this._m_fLight}}),Object.defineProperty(e.prototype,"fNoLightmap",{get:function(){return void 0!==this._m_fNoLightmap||(this._m_fNoLightmap=0!=(65536&this.flags)),this._m_fNoLightmap}}),e}();return e}()})?n.apply(e,a):n)||(t.exports=o)}},[[222,1,2]]]);